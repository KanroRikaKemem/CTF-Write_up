### I. STARTER:
#### 1. Modular Exopnentiation:
##### a) Mô tả đề bài:
- Tính $101^{17}\mod 22663$
##### b) Phân tích cách làm: 
`*pow(base, exponent, modulus)`: Tính $base^{exponent}\mod modulus$.
![image](https://hackmd.io/_uploads/SJW2Pcumke.png)
##### c) Kết quả:
`19906`
#### 2. Public Keys: 
##### a) Mô tả cách làm:
- Mã hoá $12$ bằng cách sử dụng RSA với tham số:
    - $e = 65537$
    - $p = 17$ và $q = 23$.
- Tính **modular exponentiation** của $12$.
##### b) Phân tích cách làm:
Tính $12^{65537} \mod N$
![image](https://hackmd.io/_uploads/rJrlsc_Xyx.png)
##### c) Kết quả:
`301`
#### 3. Euler's Totient:
##### a) Mô tả đề bài:
Tính $ø(N)$ với **N = p.q**:
```py
p = 857504083339712752489993810777
q = 1029224947942998075080348647219
```
##### b) Phân tích cách làm:
- Euler's totient ø(N): Số lượng $k$ trong khoảng $1$ đến $N - 1$ sao cho $gcd(k, N) = 1$.
- Khi $N = p.q$: $ø(N) = (p - 1).(q - 1)$
![image](https://hackmd.io/_uploads/BkQgysd7kl.png)
##### c) Kết quả: 
`882564595536224140639625987657529300394956519977044270821168`
#### 4. Private Key:
##### a) Mô tả đề bài:
- Tính $d$ với:
```py
p = 857504083339712752489993810777
q = 1029224947942998075080348647219
e = 65537
```
$$d \equiv e^{-1} \mod ø(N)$$
##### b) Phân tích cách làm:
![image](https://hackmd.io/_uploads/B1uSZbq7yg.png)
`pow(e, -1, phi_N)`: $e.d \equiv 1 \mod ø(N)$.
##### *c) Kết quả:* 
`121832886702415731577073962957377780195510499965398469843281`
#### 5. RSA Decryption:
##### a) Mô tả đề bài:
- Đề cho public key với:
```py
N = 882564595536224140639625987659416029426239230804614613279163
e = 65537
```
- Tìm private key để giải mã $c = 77578995801157823671636298847186723593814843845525223303932$
##### b) Phân tích cách làm:
- Ta có: $$M \equiv c^d \mod N$$
- Phân tích $N = p.q$ bằng factordb.com.
![image](https://hackmd.io/_uploads/HyEH1tqQ1x.png)
- Source code:
![image](https://hackmd.io/_uploads/HJB5R_c71g.png)
##### *c) Kết quả:* 
`13371337`
#### 6. RSA Signatures:
##### a) Mô tả đề bài:
- Giải thích cách bảo vệ tính toàn vẹn của một thông điệp trong trường hợp nó có thể bị giả mạo trong quá trình truyền tải bằng cách sử dụng chữ ký số.
- Cụ thể trong tình huống:
    - Sử dụng Public Key để mã hóa thông điệp $m$.
    - Sử dụng hàm băm $H(m)$ và mã hoá nó với Private Key $S = H(m)^{d_{1}} \mod N_{1}$
        *Trong các hệ thống mật mã thực, cách tốt nhất là sử dụng các khóa riêng biệt để mã hóa và ký tin nhắn.*
    - Giải mã thông điệp bằng cách sử dụng Private Key.
    - So sánh $assert H(m) == s$ để đảm bảo rằng thông điệp nhận được không bị giải mã. 
    - Ký `crypto{Immut4ble_m3ssag1ng}` bằng cách sử dụng khoá riêng và hàm băm **SHA256** đã chuyển thành số nguyên.
##### b) Phân tích cách làm:
- Với:
```py 
mex = "crypto{Immut4ble_m3ssag1ng}"
N = 15216583654836731327639981224133918855895948374072384050848479908982286890731769486609085918857664046075375253168955058743185664390273058074450390236774324903305663479046566232967297765731625328029814055635316002591227570271271445226094919864475407884459980489638001092788574811554149774028950310695112688723853763743238753349782508121985338746755237819373178699343135091783992299561827389745132880022259873387524273298850340648779897909381979714026837172003953221052431217940632552930880000919436507245150726543040714721553361063311954285289857582079880295199632757829525723874753306371990452491305564061051059885803
d = 11175901210643014262548222473449533091378848269490518850474399681690547281665059317155831692300453197335735728459259392366823302405685389586883670043744683993709123180805154631088513521456979317628012721881537154107239389466063136007337120599915456659758559300673444689263854921332185562706707573660658164991098457874495054854491474065039621922972671588299315846306069845169959451250821044417886630346229021305410340100401530146135418806544340908355106582089082980533651095594192031411679866134256418292249592135441145384466261279428795408721990564658703903787956958168449841491667690491585550160457893350536334242689
```
![image](https://hackmd.io/_uploads/rksQLUi7Je.png)

##### c) Kết quả:
```
13480738404590090803339831649238454376183189744970683129909766078877706583282422686710545217275797376709672358894231550335007974983458408620258478729775647818876610072903021235573923300070103666940534047644900475773318682585772698155617451477448441198150710420818995347235921111812068656782998168064960965451719491072569057636701190429760047193261886092862024118487826452766513533860734724124228305158914225250488399673645732882077575252662461860972889771112594906884441454355959482925283992539925713424132009768721389828848907099772040836383856524605008942907083490383109757406940540866978237471686296661685839083475
```
### II. PRIMES PART 1:
#### 1. Factoring:
##### a) Mô tả đề bài:
- Số nguyên nhỏ không an toàn cho RSA vì có thể bị phân tích nhân tử dễ dàng.
- Khuyến nghị số nguyên tố có độ dài ít nhất 1024 bit để modulus lớn 2048 bit gọi là **RSA - 2048**.
- Trong tương lai, nên sử dụng **RSA - 4096**, **RSA - 8192** để tăng cường bảo mật dù điều này làm chậm quá trình tính toán.
- Phân tích số $150$ bit `510143758735509025530880200653196460532653147` thành tích hai số nguyên tố, flag là số nhỏ hơn.
##### b) Phân tích cách làm:
Dùng factordb.com:
![image](https://hackmd.io/_uploads/HJjYLlh7yl.png)
##### *c) Kết quả:* 
`19704762736204164635843`
#### 2. Inferius Prime:
##### a) Mô tả đề bài:
Cho file triển khai RSA mạnh $1600$ bit, gồm:
+ Source code giải mã.
+ Public Key.
##### b) Phân tích cách làm:
- Thông số được cho:
![image](https://hackmd.io/_uploads/SybX_x3mJe.png)
- Phân tích $n = p.q$ bằng factordb.com:
![image](https://hackmd.io/_uploads/BJe9l9g2Q1e.png)
- Dùng source có sẵn, đưa các thông số vào:
![image](https://hackmd.io/_uploads/BkSW2gnmkg.png)
##### c) Kết quả:
`crypto{N33d_b1g_pR1m35}`
#### 3. Monoprime:
##### a) Mô tả đề bài:
- *"Tại sao mọi người lại bị ám ảnh bởi việc nhân hai số nguyên tố cho RSA. Tại sao không chỉ sử dụng một?"* $\Rightarrow$ **Vẫn được nhưng không an toàn**.
- Cho file gồm:
```py
n = 171731371218065444125482536302245915415603318380280392385291836472299752747934607246477508507827284075763910264995326010251268493630501989810855418416643352631102434317900028697993224868629935657273062472544675693365930943308086634291936846505861203914449338007760990051788980485462592823446469606824421932591**
e = 65537
ct = 161367550346730604451454756189028938964941280347662098798775466019463375610700074840105776873791605070092554650190486030367121011578171525759600774739890458414593857709994072516290998135846956596662071379067305011746842247628316996977338024343628757374524136260758515864509435302781735938531030576289086798942
```
##### b) Phân tích cách làm:
Tương tự bài trên, tìm được $p = q = n$ từ factordb.com:
![image](https://hackmd.io/_uploads/BJvjminQJe.png)
##### c) Kết quả: 
`crypto{0n3_pr1m3_41n7_pr1m3_l0l}`
#### 4. Square Eyes:
##### a) Mô tả đề bài:
- *"Mất rất nhiều thời gian để tìm số nguyên tố 2048 bit nên đã tạo một số nguyên tố và sử dụng nó hai lần. Hint: công thức tính tổng Euler"*.
- Cho file gồm:
```py
n = 535860808044009550029177135708168016201451343147313565371014459027743491739422885443084705720731409713775527993719682583669164873806842043288439828071789970694759080842162253955259590552283047728782812946845160334801782088068154453021936721710269050985805054692096738777321796153384024897615594493453068138341203673749514094546000253631902991617197847584519694152122765406982133526594928685232381934742152195861380221224370858128736975959176861651044370378539093990198336298572944512738570839396588590096813217791191895941380464803377602779240663133834952329316862399581950590588006371221334128215409197603236942597674756728212232134056562716399155080108881105952768189193728827484667349378091100068224404684701674782399200373192433062767622841264055426035349769018117299620554803902490432339600566432246795818167460916180647394169157647245603555692735630862148715428791242764799469896924753470539857080767170052783918273180304835318388177089674231640910337743789750979216202573226794240332797892868276309400253925932223895530714169648116569013581643192341931800785254715083294526325980247219218364118877864892068185905587410977152737936310734712276956663192182487672474651103240004173381041237906849437490609652395748868434296753449
e = 65537
ct = 222502885974182429500948389840563415291534726891354573907329512556439632810921927905220486727807436668035929302442754225952786602492250448020341217733646472982286222338860566076161977786095675944552232391481278782019346283900959677167026636830252067048759720251671811058647569724495547940966885025629807079171218371644528053562232396674283745310132242492367274184667845174514466834132589971388067076980563188513333661165819462428837210575342101036356974189393390097403614434491507672459254969638032776897417674577487775755539964915035731988499983726435005007850876000232292458554577437739427313453671492956668188219600633325930981748162455965093222648173134777571527681591366164711307355510889316052064146089646772869610726671696699221157985834325663661400034831442431209123478778078255846830522226390964119818784903330200488705212765569163495571851459355520398928214206285080883954881888668509262455490889283862560453598662919522224935145694435885396500780651530829377030371611921181207362217397805303962112100190783763061909945889717878397740711340114311597934724670601992737526668932871436226135393872881664511222789565256059138002651403875484920711316522536260604255269532161594824301047729082877262812899724246757871448545439896
```
##### b) Phân tích cách làm:
- Tìm được $p = q$ qua factordb.com:
```
p = 23148667521998097720857168827790771337662483716348435477360567409355026169165934446949809664595523770853897203103759106983985113264049057416908191166720008503275951625738975666019029172377653170602440373579593292576530667773951407647222757756437867216095193174201323278896027294517792607881861855264600525772460745259440301156930943255240915685718552334192230264780355799179037816026330705422484000086542362084006958158550346395941862383925942033730030004606360308379776255436206440529441711859246811586652746028418496020145441513037535475380962562108920699929022900677901988508936509354385660735694568216631382653107
```
- **Euler's totient**: 
    - Phân tích **n** thành tích các thừa số nguyên tố $p_{1}$, $p_{2}$,..., $p_{n}$.
    - Công thức: **$ø(n) = n.(1 - \frac{1}{p_{1}}).(1 - \frac{1}{p_{2}})...(1 - \frac{1}{p_{n}})$**
    $\Rightarrow$ Trong trường hợp đề cho: $ø(n) = n.(1 - \frac{1}{p}) = p^2.(1 - \frac{1}{p}) = p.(p - 1)$
- Tương tự bài trước: 
![image](https://hackmd.io/_uploads/HJMWXsT7yx.png)
##### c) Kết quả: 
`crypto{squar3_r00t_i5_f4st3r_th4n_f4ct0r1ng!}`
#### 5. Manyprime:
##### a) Mô tả đề bài:
- Nếu phân tích $n$ thì có hơn $30$ thừa số nguyên tố.
- Phân tích mất nhiều thời gian, gợi ý phương pháp **ECM (The Elliptic Curve Factorization Method)** để phân tích thừa số nguyên tố.
- Cho file:
```py
n = 580642391898843192929563856870897799650883152718761762932292482252152591279871421569162037190419036435041797739880389529593674485555792234900969402019055601781662044515999210032698275981631376651117318677368742867687180140048715627160641771118040372573575479330830092989800730105573700557717146251860588802509310534792310748898504394966263819959963273509119791037525504422606634640173277598774814099540555569257179715908642917355365791447508751401889724095964924513196281345665480688029639999472649549163147599540142367575413885729653166517595719991872223011969856259344396899748662101941230745601719730556631637
e = 65537
ct = 320721490534624434149993723527322977960556510750628354856260732098109692581338409999983376131354918370047625150454728718467998870322344980985635149656977787964380651868131740312053755501594999166365821315043312308622388016666802478485476059625888033017198083472976011719998333985531756978678758897472845358167730221506573817798467100023754709109274265835201757369829744113233607359526441007577850111228850004361838028842815813724076511058179239339760639518034583306154826603816927757236549096339501503316601078891287408682099750164720032975016814187899399273719181407940397071512493967454225665490162619270814464
```
##### b) Phân tích cách làm:
- Dùng factordb.com:
![image](https://hackmd.io/_uploads/B1yYVilEJl.png)
- Ta có: $ø(n) = (p - 1)*(q - 1)$. Khai báo biến `phi_N = 1` và chạy vòng lặp duyệt từng phần tử trong các số nguyên tố vừa tìm được.
![image](https://hackmd.io/_uploads/rJEAwjxNyx.png)
##### c) Kết quả:
`crypto{700_m4ny_5m4ll_f4c70r5}`
### III. PUBLIC EXPONENT:
#### 1. Salty:
##### a) Mô tả đề bài:
- *"Số mũ nhỏ nhất sẽ nhanh nhất phải không?"* 
- Cho file:
```py
n = 110581795715958566206600392161360212579669637391437097703685154237017351570464767725324182051199901920318211290404777259728923614917211291562555864753005179326101890427669819834642007924406862482343614488768256951616086287044725034412802176312273081322195866046098595306261781788276570920467840172004530873767
e = 
ct = 44981230718212183604274785925793145442655465025264554046028251311164494127485
```
##### b) Phân tích cách làm:
Phân tích $n = p.q$ bởi factordb.com, được $p = q$.
![image](https://hackmd.io/_uploads/Skdd70bVyl.png)
##### c) Kết quả:
`crypto{saltstack_fell_for_this!}`
#### 2. Modulus Inustilis:
##### a) Mô tả đề bài:
- *"Các số nguyên tố đã đủ lớn."*
- Cho file:
```py
n = 17258212916191948536348548470938004244269544560039009244721959293554822498047075403658429865201816363311805874117705688359853941515579440852166618074161313773416434156467811969628473425365608002907061241714688204565170146117869742910273064909154666642642308154422770994836108669814632309362483307560217924183202838588431342622551598499747369771295105890359290073146330677383341121242366368309126850094371525078749496850520075015636716490087482193603562501577348571256210991732071282478547626856068209192987351212490642903450263288650415552403935705444809043563866466823492258216747445926536608548665086042098252335883
e = 3
ct = 243251053617903760309941844835411292373350655973075480264001352919865180151222189820473358411037759381328642957324889519192337152355302808400638052620580409813222660643570085177957
```
##### b) Phân tích cách làm:
Công thức: $ct = pt^e (\mod n) \Rightarrow pt^e = ct%n$
![image](https://hackmd.io/_uploads/Hy9x00bVyl.png)
##### c) Kết quả:
`crypto{N33d_m04R_p4dd1ng}`
#### 3. Everything is Big:
##### a) Mô tả đề bài:
- *"Có một siêu máy tính đang hoạt động, vì vậy tôi đảm bảo mã hóa của mình an toàn bằng cách chọn số lượng lớn!"*
- Cho file:
```py
N = 0xb8af3d3afb893a602de4afe2a29d7615075d1e570f8bad8ebbe9b5b9076594cf06b6e7b30905b6420e950043380ea746f0a14dae34469aa723e946e484a58bcd92d1039105871ffd63ffe64534b7d7f8d84b4a569723f7a833e6daf5e182d658655f739a4e37bd9f4a44aff6ca0255cda5313c3048f56eed5b21dc8d88bf5a8f8379eac83d8523e484fa6ae8dbcb239e65d3777829a6903d779cd2498b255fcf275e5f49471f35992435ee7cade98c8e82a8beb5ce1749349caa16759afc4e799edb12d299374d748a9e3c82e1cc983cdf9daec0a2739dadcc0982c1e7e492139cbff18c5d44529407edfd8e75743d2f51ce2b58573fea6fbd4fe25154b9964d
e = 0x9ab58dbc8049b574c361573955f08ea69f97ecf37400f9626d8f5ac55ca087165ce5e1f459ef6fa5f158cc8e75cb400a7473e89dd38922ead221b33bc33d6d716fb0e4e127b0fc18a197daf856a7062b49fba7a86e3a138956af04f481b7a7d481994aeebc2672e500f3f6d8c581268c2cfad4845158f79c2ef28f242f4fa8f6e573b8723a752d96169c9d885ada59cdeb6dbe932de86a019a7e8fc8aeb07748cfb272bd36d94fe83351252187c2e0bc58bb7a0a0af154b63397e6c68af4314601e29b07caed301b6831cf34caa579eb42a8c8bf69898d04b495174b5d7de0f20cf2b8fc55ed35c6ad157d3e7009f16d6b61786ee40583850e67af13e9d25be3
c = 0x3f984ff5244f1836ed69361f29905ca1ae6b3dcf249133c398d7762f5e277919174694293989144c9d25e940d2f66058b2289c75d1b8d0729f9a7c4564404a5fd4313675f85f31b47156068878e236c5635156b0fa21e24346c2041ae42423078577a1413f41375a4d49296ab17910ae214b45155c4570f95ca874ccae9fa80433a1ab453cbb28d780c2f1f4dc7071c93aff3924d76c5b4068a0371dff82531313f281a8acadaa2bd5078d3ddcefcb981f37ff9b8b14c7d9bf1accffe7857160982a2c7d9ee01d3e82265eec9c7401ecc7f02581fd0d912684f42d1b71df87a1ca51515aab4e58fab4da96e154ea6cdfb573a71d81b2ea4a080a1066e1bc3474
```
##### b) Phân tích cách làm:
- Thông số đề cho ở dạng hex nên cần chuyển về dạng số nguyên:
![image](https://hackmd.io/_uploads/rJV6zyM41x.png)
- Phân tích $N$ thành tích các thừa số nguyên tố (factordb.com):
![image](https://hackmd.io/_uploads/ByKCzyGE1g.png)
Ta được:
```py
p = 134669927709128070756424801419548805501808076912262801434800605920827612464368906595661348393409080650056282638489243851059781971132159889896843018381187994628859917822755789986092763460463295405651440816348815008245093856412009397970192375577360567873185141159375280522236909060526334123001733587717969177157
q = 173121513995818161102245832683211062320154182361182024148671930683926870711405647497524667705258311163551127156955342410807842326402024536548989691926348678692995530897791794818646241971728281417961389048493180792474943296919266335463768525410560161755731138916915767148609523790355387780727531897114371948649
```
- Tương tự bài trước:
![image](https://hackmd.io/_uploads/B1NyEJfE1l.png)
- Đầy đủ:
![image](https://hackmd.io/_uploads/SJ-b4yfE1l.png)
##### c) Kết quả:
`crypto{s0m3th1ng5_c4n_b3_t00_b1g}`
#### 4. Crossed Wires:
##### a) Mô tả đề bài:
Cho năm số mũ **e** khác nhau, tìm $d = d_{1}.d_{2}.d_{3}.d_{4}.d_{5}$ với $e = 65537$.
##### b) Phân tích cách làm:
Tìm $p$, $q$ từ factordb.com.
```py
from Crypto.Util.number import long_to_bytes
n = 21711308225346315542706844618441565741046498277716979943478360598053144971379956916575370343448988601905854572029635846626259487297950305231661109855854947494209135205589258643517961521594924368498672064293208230802441077390193682958095111922082677813175804775628884377724377647428385841831277059274172982280545237765559969228707506857561215268491024097063920337721783673060530181637161577401589126558556182546896783307370517275046522704047385786111489447064794210010802761708615907245523492585896286374996088089317826162798278528296206977900274431829829206103227171839270887476436899494428371323874689055690729986771
ct = 20304610279578186738172766224224793119885071262464464448863461184092225736054747976985179673905441502689126216282897704508745403799054734121583968853999791604281615154100736259131453424385364324630229671185343778172807262640709301838274824603101692485662726226902121105591137437331463201881264245562214012160875177167442010952439360623396658974413900469093836794752270399520074596329058725874834082188697377597949405779039139194196065364426213208345461407030771089787529200057105746584493554722790592530472869581310117300343461207750821737840042745530876391793484035024644475535353227851321505537398888106855012746117
p = 134460556242811604004061671529264401215233974442536870999694816691450423689575549530215841622090861571494882591368883283016107051686642467260643894947947473532769025695530343815260424314855023688439603651834585971233941772580950216838838690315383700689885536546289584980534945897919914730948196240662991266027
q = 161469718942256895682124261315253003309512855995894840701317251772156087404025170146631429756064534716206164807382734456438092732743677793224010769460318383691408352089793973150914149255603969984103815563896440419666191368964699279209687091969164697704779792586727943470780308857107052647197945528236341228473
e1, e2, e3, e4, e5 = 106979, 108533, 69557, 97117, 103231
e = 65537
phi = (p - 1)*(q - 1)
d1, d2, d3, d4, d5 = pow(e1, -1, phi), pow(e2, -1, phi), pow(e3, -1, phi), pow(e4, -1, phi), pow(e5, -1, phi)
d = d1*d2*d3*d4*d5
pt = pow(ct, d, n)
print(long_to_bytes(pt))
```
##### c) Kết quả:
`crypto{3ncrypt_y0ur_s3cr3t_w1th_y0ur_fr1end5_publ1c_k3y}`
#### 5. Everything is Still Big:
##### a) Mô tả đề bài:
##### b) Phân tích cách làm:
Có thể làm hai cách:
- Cách 1: Tương tự bài trên:
```py
from Crypto.Util.number import long_to_bytes
N = "0xb12746657c720a434861e9a4828b3c89a6b8d4a1bd921054e48d47124dbcc9cfcdcc39261c5e93817c167db818081613f57729e0039875c72a5ae1f0bc5ef7c933880c2ad528adbc9b1430003a491e460917b34c4590977df47772fab1ee0ab251f94065ab3004893fe1b2958008848b0124f22c4e75f60ed3889fb62e5ef4dcc247a3d6e23072641e62566cd96ee8114b227b8f498f9a578fc6f687d07acdbb523b6029c5bbeecd5efaf4c4d35304e5e6b5b95db0e89299529eb953f52ca3247d4cd03a15939e7d638b168fd00a1cb5b0cc5c2cc98175c1ad0b959c2ab2f17f917c0ccee8c3fe589b4cb441e817f75e575fc96a4fe7bfea897f57692b050d2b"
e = "0x9d0637faa46281b533e83cc37e1cf5626bd33f712cc1948622f10ec26f766fb37b9cd6c7a6e4b2c03bce0dd70d5a3a28b6b0c941d8792bc6a870568790ebcd30f40277af59e0fd3141e272c48f8e33592965997c7d93006c27bf3a2b8fb71831dfa939c0ba2c7569dd1b660efc6c8966e674fbe6e051811d92a802c789d895f356ceec9722d5a7b617d21b8aa42dd6a45de721953939a5a81b8dffc9490acd4f60b0c0475883ff7e2ab50b39b2deeedaefefffc52ae2e03f72756d9b4f7b6bd85b1a6764b31312bc375a2298b78b0263d492205d2a5aa7a227abaf41ab4ea8ce0e75728a5177fe90ace36fdc5dba53317bbf90e60a6f2311bb333bf55ba3245f"
c = "0xa3bce6e2e677d7855a1a7819eb1879779d1e1eefa21a1a6e205c8b46fdc020a2487fdd07dbae99274204fadda2ba69af73627bdddcb2c403118f507bca03cb0bad7a8cd03f70defc31fa904d71230aab98a10e155bf207da1b1cac1503f48cab3758024cc6e62afe99767e9e4c151b75f60d8f7989c152fdf4ff4b95ceed9a7065f38c68dee4dd0da503650d3246d463f504b36e1d6fafabb35d2390ecf0419b2bb67c4c647fb38511b34eb494d9289c872203fa70f4084d2fa2367a63a8881b74cc38730ad7584328de6a7d92e4ca18098a15119baee91237cea24975bdfc19bdbce7c1559899a88125935584cd37c8dd31f3f2b4517eefae84e7e588344fa5"
N = int(N, 16)
e = int(e, 16)
c = int(c, 16)
#print(N) 
p = 126941806460244095377115101056215170200213929484090514615615360791047815508282999312547430020357429932308768712158161906404559758053111268332560036207583087350177765905028171368043071041697143783557751018420251412743117633405829486334952312669390185416378995607092112979722242788438125727258195819223984881293
q = 176171647623796415963359037459080158279832338949959164916683927127298628490481547783271812783698644240568426097637418877451963005025506022174220789400439434207167210194263661330803801184790705595672502832081604208722809411817374316086936064983248582792693864440342630864686435882656704880417413599728301262999
phi = (p - 1)*(q - 1)
d = pow(e, -1, phi)
pt = pow(c, d, N)
print(long_to_bytes(pt))
```
- Cách 2: Sử dụng **Wiener's Attack**: Điều kiện: $d < \frac{n}{3}$ (khoá $d << n$, $d$ thường dưới 1024 bit):
```py
from Crypto.Util.number import long_to_bytes
import owiener
N = "0xb12746657c720a434861e9a4828b3c89a6b8d4a1bd921054e48d47124dbcc9cfcdcc39261c5e93817c167db818081613f57729e0039875c72a5ae1f0bc5ef7c933880c2ad528adbc9b1430003a491e460917b34c4590977df47772fab1ee0ab251f94065ab3004893fe1b2958008848b0124f22c4e75f60ed3889fb62e5ef4dcc247a3d6e23072641e62566cd96ee8114b227b8f498f9a578fc6f687d07acdbb523b6029c5bbeecd5efaf4c4d35304e5e6b5b95db0e89299529eb953f52ca3247d4cd03a15939e7d638b168fd00a1cb5b0cc5c2cc98175c1ad0b959c2ab2f17f917c0ccee8c3fe589b4cb441e817f75e575fc96a4fe7bfea897f57692b050d2b"
e = "0x9d0637faa46281b533e83cc37e1cf5626bd33f712cc1948622f10ec26f766fb37b9cd6c7a6e4b2c03bce0dd70d5a3a28b6b0c941d8792bc6a870568790ebcd30f40277af59e0fd3141e272c48f8e33592965997c7d93006c27bf3a2b8fb71831dfa939c0ba2c7569dd1b660efc6c8966e674fbe6e051811d92a802c789d895f356ceec9722d5a7b617d21b8aa42dd6a45de721953939a5a81b8dffc9490acd4f60b0c0475883ff7e2ab50b39b2deeedaefefffc52ae2e03f72756d9b4f7b6bd85b1a6764b31312bc375a2298b78b0263d492205d2a5aa7a227abaf41ab4ea8ce0e75728a5177fe90ace36fdc5dba53317bbf90e60a6f2311bb333bf55ba3245f"
c = "0xa3bce6e2e677d7855a1a7819eb1879779d1e1eefa21a1a6e205c8b46fdc020a2487fdd07dbae99274204fadda2ba69af73627bdddcb2c403118f507bca03cb0bad7a8cd03f70defc31fa904d71230aab98a10e155bf207da1b1cac1503f48cab3758024cc6e62afe99767e9e4c151b75f60d8f7989c152fdf4ff4b95ceed9a7065f38c68dee4dd0da503650d3246d463f504b36e1d6fafabb35d2390ecf0419b2bb67c4c647fb38511b34eb494d9289c872203fa70f4084d2fa2367a63a8881b74cc38730ad7584328de6a7d92e4ca18098a15119baee91237cea24975bdfc19bdbce7c1559899a88125935584cd37c8dd31f3f2b4517eefae84e7e588344fa5"
N = int(N, 16)
e = int(e, 16)
c = int(c, 16)
d = owiener.attack(e, N)
pt = pow(c, d, N)
print(long_to_bytes(pt))
```
##### c) Kết quả:
`crypto{bon3h5_4tt4ck_i5_sr0ng3r_th4n_w13n3r5}`
#### 6. Endless Emails:
##### a) Mô tả đề bài:
- *"Tội nghiệp Johan đã phải trả lời email cả ngày và nhiều sinh viên cũng hỏi câu hỏi tương tự. Bạn có đọc được tin nhắn của anh ấy không?"*
- Cho source code:
```py
#!/usr/bin/env python3

from Crypto.Util.number import bytes_to_long, getPrime
from secret import messages

def RSA_encrypt(message):
    m = bytes_to_long(message)
    p = getPrime(1024)
    q = getPrime(1024)
    N = p * q
    e = 3
    c = pow(m, e, N)
    return N, e, c

for m in messages:
    N, e, c = RSA_encrypt(m)
    print(f"n = {N}")
    print(f"e = {e}")
    print(f"c = {c}")
```
Và đoạn output:
```py
n = 14528915758150659907677315938876872514853653132820394367681510019000469589767908107293777996420037715293478868775354645306536953789897501630398061779084810058931494642860729799059325051840331449914529594113593835549493208246333437945551639983056810855435396444978249093419290651847764073607607794045076386643023306458718171574989185213684263628336385268818202054811378810216623440644076846464902798568705083282619513191855087399010760232112434412274701034094429954231366422968991322244343038458681255035356984900384509158858007713047428143658924970374944616430311056440919114824023838380098825914755712289724493770021
e = 3
c = 6965891612987861726975066977377253961837139691220763821370036576350605576485706330714192837336331493653283305241193883593410988132245791554283874785871849223291134571366093850082919285063130119121338290718389659761443563666214229749009468327825320914097376664888912663806925746474243439550004354390822079954583102082178617110721589392875875474288168921403550415531707419931040583019529612270482482718035497554779733578411057633524971870399893851589345476307695799567919550426417015815455141863703835142223300228230547255523815097431420381177861163863791690147876158039619438793849367921927840731088518955045807722225


n = 20463913454649855046677206889944639231694511458416906994298079596685813354570085475890888433776403011296145408951323816323011550738170573801417972453504044678801608709931200059967157605416809387753258251914788761202456830940944486915292626560515250805017229876565916349963923702612584484875113691057716315466239062005206014542088484387389725058070917118549621598629964819596412564094627030747720659155558690124005400257685883230881015636066183743516494701900125788836869358634031031172536767950943858472257519195392986989232477630794600444813136409000056443035171453870906346401936687214432176829528484662373633624123
e = 3
c = 5109363605089618816120178319361171115590171352048506021650539639521356666986308721062843132905170261025772850941702085683855336653472949146012700116070022531926476625467538166881085235022484711752960666438445574269179358850309578627747024264968893862296953506803423930414569834210215223172069261612934281834174103316403670168299182121939323001232617718327977313659290755318972603958579000300780685344728301503641583806648227416781898538367971983562236770576174308965929275267929379934367736694110684569576575266348020800723535121638175505282145714117112442582416208209171027273743686645470434557028336357172288865172


n = 19402640770593345339726386104915705450969517850985511418263141255686982818547710008822417349818201858549321868878490314025136645036980129976820137486252202687238348587398336652955435182090722844668488842986318211649569593089444781595159045372322540131250208258093613844753021272389255069398553523848975530563989367082896404719544411946864594527708058887475595056033713361893808330341623804367785721774271084389159493974946320359512776328984487126583015777989991635428744050868653379191842998345721260216953918203248167079072442948732000084754225272238189439501737066178901505257566388862947536332343196537495085729147
e = 3
c = 5603386396458228314230975500760833991383866638504216400766044200173576179323437058101562931430558738148852367292802918725271632845889728711316688681080762762324367273332764959495900563756768440309595248691744845766607436966468714038018108912467618638117493367675937079141350328486149333053000366933205635396038539236203203489974033629281145427277222568989469994178084357460160310598260365030056631222346691527861696116334946201074529417984624304973747653407317290664224507485684421999527164122395674469650155851869651072847303136621932989550786722041915603539800197077294166881952724017065404825258494318993054344153


n = 12005639978012754274325188681720834222130605634919280945697102906256738419912110187245315232437501890545637047506165123606573171374281507075652554737014979927883759915891863646221205835211640845714836927373844277878562666545230876640830141637371729405545509920889968046268135809999117856968692236742804637929866632908329522087977077849045608566911654234541526643235586433065170392920102840518192803854740398478305598092197183671292154743153130012885747243219372709669879863098708318993844005566984491622761795349455404952285937152423145150066181043576492305166964448141091092142224906843816547235826717179687198833961
e = 3
c = 1522280741383024774933280198410525846833410931417064479278161088248621390305797210285777845359812715909342595804742710152832168365433905718629465545306028275498667935929180318276445229415104842407145880223983428713335709038026249381363564625791656631137936935477777236936508600353416079028339774876425198789629900265348122040413865209592074731028757972968635601695468594123523892918747882221891834598896483393711851510479989203644477972694520237262271530260496342247355761992646827057846109181410462131875377404309983072358313960427035348425800940661373272947647516867525052504539561289941374722179778872627956360577


n = 17795451956221451086587651307408104001363221003775928432650752466563818944480119932209305765249625841644339021308118433529490162294175590972336954199870002456682453215153111182451526643055812311071588382409549045943806869173323058059908678022558101041630272658592291327387549001621625757585079662873501990182250368909302040015518454068699267914137675644695523752851229148887052774845777699287718342916530122031495267122700912518207571821367123013164125109174399486158717604851125244356586369921144640969262427220828940652994276084225196272504355264547588369516271460361233556643313911651916709471353368924621122725823
e = 3
c = 8752507806125480063647081749506966428026005464325535765874589376572431101816084498482064083887400646438977437273700004934257274516197148448425455243811009944321764771392044345410680448204581679548854193081394891841223548418812679441816502910830861271884276608891963388657558218620911858230760629700918375750796354647493524576614017731938584618983084762612414591830024113057983483156974095503392359946722756364412399187910604029583464521617256125933111786441852765229820406911991809039519015434793656710199153380699319611499255869045311421603167606551250174746275803467549814529124250122560661739949229005127507540805


n = 25252721057733555082592677470459355315816761410478159901637469821096129654501579313856822193168570733800370301193041607236223065376987811309968760580864569059669890823406084313841678888031103461972888346942160731039637326224716901940943571445217827960353637825523862324133203094843228068077462983941899571736153227764822122334838436875488289162659100652956252427378476004164698656662333892963348126931771536472674447932268282205545229907715893139346941832367885319597198474180888087658441880346681594927881517150425610145518942545293750127300041942766820911120196262215703079164895767115681864075574707999253396530263
e = 3
c = 23399624135645767243362438536844425089018405258626828336566973656156553220156563508607371562416462491581383453279478716239823054532476006642583363934314982675152824147243749715830794488268846671670287617324522740126594148159945137948643597981681529145611463534109482209520448640622103718682323158039797577387254265854218727476928164074249568031493984825273382959147078839665114417896463735635546290504843957780546550577300001452747760982468547756427137284830133305010038339400230477403836856663883956463830571934657200851598986174177386323915542033293658596818231793744261192870485152396793393026198817787033127061749


n = 19833203629283018227011925157509157967003736370320129764863076831617271290326613531892600790037451229326924414757856123643351635022817441101879725227161178559229328259469472961665857650693413215087493448372860837806619850188734619829580286541292997729705909899738951228555834773273676515143550091710004139734080727392121405772911510746025807070635102249154615454505080376920778703360178295901552323611120184737429513669167641846902598281621408629883487079110172218735807477275590367110861255756289520114719860000347219161944020067099398239199863252349401303744451903546571864062825485984573414652422054433066179558897
e = 3
c = 15239683995712538665992887055453717247160229941400011601942125542239446512492703769284448009141905335544729440961349343533346436084176947090230267995060908954209742736573986319254695570265339469489948102562072983996668361864286444602534666284339466797477805372109723178841788198177337648499899079471221924276590042183382182326518312979109378616306364363630519677884849945606288881683625944365927809405420540525867173639222696027472336981838588256771671910217553150588878434061862840893045763456457939944572192848992333115479951110622066173007227047527992906364658618631373790704267650950755276227747600169403361509144
```
##### b) Phân tích cách làm:
- Với $e = 3$ và **Hastad's Broadcast Attack**, cần lựa chọn ra bộ ba kết hợp của bảy cặp $(n, c)$, có thể đoán được rằng $C = m^3$.
- Tấn công theo **CRT (Chinese Remainder Theorem)** với hệ phương trình: $$\begin{align}
      c_i = m^e \mod n_i \\
      c_j = m^e \mod n_j \\
      c_k = m^e \mod n_k
    \end{align}$$ Theo CRT, có thể kết hợp các phương trình này thành $$C = m^e \mod N$$ với $N = n_i.n_j.n_k$.
    - Ta có: $$\begin{align}
      N_i = \frac{N}{n_i} \\
      N_j = \frac{N}{n_j} \\
      N_k = \frac{N}{n_k}
    \end{align}$$
    - Từ các dòng trên: $$\begin{align}
      u_i = N_i^{-1} \mod n_i \\
      u_j = N_j^{-1} \mod n_j \\
      u_k = N_k^{-1} \mod n_k
    \end{align}$$
    - Suy ra: $$C = (c_i.u_i.N_i + c_j.u_j.N_j + c_k.u_k.N_k) \mod N$$
    - Suy ra: $$m = \sqrt[3]{C}$$
    - Source code:
    ```py
    from Crypto.Util.number import long_to_bytes
    from gmpy2 import iroot
    from itertools import combinations

    e = 3
    n = [14528915758150659907677315938876872514853653132820394367681510019000469589767908107293777996420037715293478868775354645306536953789897501630398061779084810058931494642860729799059325051840331449914529594113593835549493208246333437945551639983056810855435396444978249093419290651847764073607607794045076386643023306458718171574989185213684263628336385268818202054811378810216623440644076846464902798568705083282619513191855087399010760232112434412274701034094429954231366422968991322244343038458681255035356984900384509158858007713047428143658924970374944616430311056440919114824023838380098825914755712289724493770021, 20463913454649855046677206889944639231694511458416906994298079596685813354570085475890888433776403011296145408951323816323011550738170573801417972453504044678801608709931200059967157605416809387753258251914788761202456830940944486915292626560515250805017229876565916349963923702612584484875113691057716315466239062005206014542088484387389725058070917118549621598629964819596412564094627030747720659155558690124005400257685883230881015636066183743516494701900125788836869358634031031172536767950943858472257519195392986989232477630794600444813136409000056443035171453870906346401936687214432176829528484662373633624123, 19402640770593345339726386104915705450969517850985511418263141255686982818547710008822417349818201858549321868878490314025136645036980129976820137486252202687238348587398336652955435182090722844668488842986318211649569593089444781595159045372322540131250208258093613844753021272389255069398553523848975530563989367082896404719544411946864594527708058887475595056033713361893808330341623804367785721774271084389159493974946320359512776328984487126583015777989991635428744050868653379191842998345721260216953918203248167079072442948732000084754225272238189439501737066178901505257566388862947536332343196537495085729147, 12005639978012754274325188681720834222130605634919280945697102906256738419912110187245315232437501890545637047506165123606573171374281507075652554737014979927883759915891863646221205835211640845714836927373844277878562666545230876640830141637371729405545509920889968046268135809999117856968692236742804637929866632908329522087977077849045608566911654234541526643235586433065170392920102840518192803854740398478305598092197183671292154743153130012885747243219372709669879863098708318993844005566984491622761795349455404952285937152423145150066181043576492305166964448141091092142224906843816547235826717179687198833961, 17795451956221451086587651307408104001363221003775928432650752466563818944480119932209305765249625841644339021308118433529490162294175590972336954199870002456682453215153111182451526643055812311071588382409549045943806869173323058059908678022558101041630272658592291327387549001621625757585079662873501990182250368909302040015518454068699267914137675644695523752851229148887052774845777699287718342916530122031495267122700912518207571821367123013164125109174399486158717604851125244356586369921144640969262427220828940652994276084225196272504355264547588369516271460361233556643313911651916709471353368924621122725823, 25252721057733555082592677470459355315816761410478159901637469821096129654501579313856822193168570733800370301193041607236223065376987811309968760580864569059669890823406084313841678888031103461972888346942160731039637326224716901940943571445217827960353637825523862324133203094843228068077462983941899571736153227764822122334838436875488289162659100652956252427378476004164698656662333892963348126931771536472674447932268282205545229907715893139346941832367885319597198474180888087658441880346681594927881517150425610145518942545293750127300041942766820911120196262215703079164895767115681864075574707999253396530263, 19833203629283018227011925157509157967003736370320129764863076831617271290326613531892600790037451229326924414757856123643351635022817441101879725227161178559229328259469472961665857650693413215087493448372860837806619850188734619829580286541292997729705909899738951228555834773273676515143550091710004139734080727392121405772911510746025807070635102249154615454505080376920778703360178295901552323611120184737429513669167641846902598281621408629883487079110172218735807477275590367110861255756289520114719860000347219161944020067099398239199863252349401303744451903546571864062825485984573414652422054433066179558897]
    c = [6965891612987861726975066977377253961837139691220763821370036576350605576485706330714192837336331493653283305241193883593410988132245791554283874785871849223291134571366093850082919285063130119121338290718389659761443563666214229749009468327825320914097376664888912663806925746474243439550004354390822079954583102082178617110721589392875875474288168921403550415531707419931040583019529612270482482718035497554779733578411057633524971870399893851589345476307695799567919550426417015815455141863703835142223300228230547255523815097431420381177861163863791690147876158039619438793849367921927840731088518955045807722225, 5109363605089618816120178319361171115590171352048506021650539639521356666986308721062843132905170261025772850941702085683855336653472949146012700116070022531926476625467538166881085235022484711752960666438445574269179358850309578627747024264968893862296953506803423930414569834210215223172069261612934281834174103316403670168299182121939323001232617718327977313659290755318972603958579000300780685344728301503641583806648227416781898538367971983562236770576174308965929275267929379934367736694110684569576575266348020800723535121638175505282145714117112442582416208209171027273743686645470434557028336357172288865172, 5603386396458228314230975500760833991383866638504216400766044200173576179323437058101562931430558738148852367292802918725271632845889728711316688681080762762324367273332764959495900563756768440309595248691744845766607436966468714038018108912467618638117493367675937079141350328486149333053000366933205635396038539236203203489974033629281145427277222568989469994178084357460160310598260365030056631222346691527861696116334946201074529417984624304973747653407317290664224507485684421999527164122395674469650155851869651072847303136621932989550786722041915603539800197077294166881952724017065404825258494318993054344153, 1522280741383024774933280198410525846833410931417064479278161088248621390305797210285777845359812715909342595804742710152832168365433905718629465545306028275498667935929180318276445229415104842407145880223983428713335709038026249381363564625791656631137936935477777236936508600353416079028339774876425198789629900265348122040413865209592074731028757972968635601695468594123523892918747882221891834598896483393711851510479989203644477972694520237262271530260496342247355761992646827057846109181410462131875377404309983072358313960427035348425800940661373272947647516867525052504539561289941374722179778872627956360577, 8752507806125480063647081749506966428026005464325535765874589376572431101816084498482064083887400646438977437273700004934257274516197148448425455243811009944321764771392044345410680448204581679548854193081394891841223548418812679441816502910830861271884276608891963388657558218620911858230760629700918375750796354647493524576614017731938584618983084762612414591830024113057983483156974095503392359946722756364412399187910604029583464521617256125933111786441852765229820406911991809039519015434793656710199153380699319611499255869045311421603167606551250174746275803467549814529124250122560661739949229005127507540805, 23399624135645767243362438536844425089018405258626828336566973656156553220156563508607371562416462491581383453279478716239823054532476006642583363934314982675152824147243749715830794488268846671670287617324522740126594148159945137948643597981681529145611463534109482209520448640622103718682323158039797577387254265854218727476928164074249568031493984825273382959147078839665114417896463735635546290504843957780546550577300001452747760982468547756427137284830133305010038339400230477403836856663883956463830571934657200851598986174177386323915542033293658596818231793744261192870485152396793393026198817787033127061749, 15239683995712538665992887055453717247160229941400011601942125542239446512492703769284448009141905335544729440961349343533346436084176947090230267995060908954209742736573986319254695570265339469489948102562072983996668361864286444602534666284339466797477805372109723178841788198177337648499899079471221924276590042183382182326518312979109378616306364363630519677884849945606288881683625944365927809405420540525867173639222696027472336981838588256771671910217553150588878434061862840893045763456457939944572192848992333115479951110622066173007227047527992906364658618631373790704267650950755276227747600169403361509144]

    for i, j, k in combinations(range(7), 3):
        N = n[i]*n[j]*n[k]
        N_i = N//n[i]
        N_j = N//n[j]
        N_k = N//n[k]
        u_i = pow(N_i, -1, n[i])
        u_j = pow(N_j, -1, n[j])
        u_k = pow(N_k, -1, n[k])
        C = (c[i]*u_i*N_i + c[k]*u_k*N_k + c[j]*u_j*N_j)%N

        m = int(iroot(C, 3)[0])
        flag = long_to_bytes(m)

        if b'crypto' in flag:
            print(flag.decode())
            break
    ```
    - Ta được:
    ```
    yes

    ---

    Johan Hastad
    Professor in Computer Science in the Theoretical Computer Science
    Group at the School of Computer Science and Communication at KTH Royal Institute of Technology in Stockholm, Sweden.

    crypto{1f_y0u_d0nt_p4d_y0u_4r3_Vuln3rabl3}
    ```
##### c) Kết quả:
`crypto{1f_y0u_d0nt_p4d_y0u_4r3_Vuln3rabl3}`
### IV. PRIMES PART 2:
#### 1. Infinite Descent:
##### a) Mô tả đề bài:
Việc tìm các số nguyên lớn là rất chậm nên đã nghĩ ra cách tối ưu hoá.
##### b) Phân tích cách làm:*
Tìm $n = p.q$ bằng factordb.com. Tương tự bài trên:
```py
from Crypto.Util.number import long_to_bytes
n = 383347712330877040452238619329524841763392526146840572232926924642094891453979246383798913394114305368360426867021623649667024217266529000859703542590316063318592391925062014229671423777796679798747131250552455356061834719512365575593221216339005132464338847195248627639623487124025890693416305788160905762011825079336880567461033322240015771102929696350161937950387427696385850443727777996483584464610046380722736790790188061964311222153985614287276995741553706506834906746892708903948496564047090014307484054609862129530262108669567834726352078060081889712109412073731026030466300060341737504223822014714056413752165841749368159510588178604096191956750941078391415634472219765129561622344109769892244712668402761549412177892054051266761597330660545704317210567759828757156904778495608968785747998059857467440128156068391746919684258227682866083662345263659558066864109212457286114506228470930775092735385388316268663664139056183180238043386636254075940621543717531670995823417070666005930452836389812129462051771646048498397195157405386923446893886593048680984896989809135802276892911038588008701926729269812453226891776546037663583893625479252643042517196958990266376741676514631089466493864064316127648074609662749196545969926051
e = 65537
c = 98280456757136766244944891987028935843441533415613592591358482906016439563076150526116369842213103333480506705993633901994107281890187248495507270868621384652207697607019899166492132408348789252555196428608661320671877412710489782358282011364127799563335562917707783563681920786994453004763755404510541574502176243896756839917991848428091594919111448023948527766368304503100650379914153058191140072528095898576018893829830104362124927140555107994114143042266758709328068902664037870075742542194318059191313468675939426810988239079424823495317464035252325521917592045198152643533223015952702649249494753395100973534541766285551891859649320371178562200252228779395393974169736998523394598517174182142007480526603025578004665936854657294541338697513521007818552254811797566860763442604365744596444735991732790926343720102293453429936734206246109968817158815749927063561835274636195149702317415680401987150336994583752062565237605953153790371155918439941193401473271753038180560129784192800351649724465553733201451581525173536731674524145027931923204961274369826379325051601238308635192540223484055096203293400419816024111797903442864181965959247745006822690967920957905188441550106930799896292835287867403979631824085790047851383294389
p = 19579267410474709598749314750954211170621862561006233612440352022286786882372619130071639824109783540564512429081674132336811972404563957025465034025781206466631730784516337210291334356396471732168742739790464109881039219452504456611589154349427303832789968502204300316585544080003423669120186095188478480761108168299370326928127888786819392372477069515318179751702985809024210164243409544692708684215042226932081052831028570060308963093217622183111643335692361019897449265402290540025790581589980867847884281862216603571536255382298035337865885153328169634178323279004749915197270120323340416965014136429743252761521
q = 19579267410474709598749314750954211170621862561006233612440352022286786882372619130071639824109783540564512429081674132336811972404563957025465034025781206466631730784516337210291334356396471732168742739790464109881039219452504456611589154349427303832789968502204300316585544080003423669120186095188478480761108168299370326928127888786819392372477069515318179751702985809024210164243409544692708684215042226932081052831028570060308963093217622183111643335692362635203582868526178838018946986792656819885261069890315500550802303622551029821058459163702751893798676443415681144429096989664473705850619792495553724950931
phi = (p - 1)*(q - 1)
d = pow(e, -1, phi)
pt = pow(c, d, n)
print(long_to_bytes(pt))
```
##### c) Kết quả:
`crypto{f3rm47_w45_4_g3n1u5}`
#### 2. Marin's Secrets:
##### a) Mô tả đề bài:
*"Tôi đã tìm ra cách siêu nhanh để tạo ra số nguyên tố từ danh sách bí mật của mình."*
##### b) Phân tích cách làm:
Tương tự bài trên:
```py
from Crypto.Util.number import long_to_bytes
n = 658416274830184544125027519921443515789888264156074733099244040126213682497714032798116399288176502462829255784525977722903018714434309698108208388664768262754316426220651576623731617882923164117579624827261244506084274371250277849351631679441171018418018498039996472549893150577189302871520311715179730714312181456245097848491669795997289830612988058523968384808822828370900198489249243399165125219244753790779764466236965135793576516193213175061401667388622228362042717054014679032953441034021506856017081062617572351195418505899388715709795992029559042119783423597324707100694064675909238717573058764118893225111602703838080618565401139902143069901117174204252871948846864436771808616432457102844534843857198735242005309073939051433790946726672234643259349535186268571629077937597838801337973092285608744209951533199868228040004432132597073390363357892379997655878857696334892216345070227646749851381208554044940444182864026513709449823489593439017366358869648168238735087593808344484365136284219725233811605331815007424582890821887260682886632543613109252862114326372077785369292570900594814481097443781269562647303671428895764224084402259605109600363098950091998891375812839523613295667253813978434879172781217285652895469194181218343078754501694746598738215243769747956572555989594598180639098344891175879455994652382137038240166358066403475457 
e = 65537
c = 400280463088930432319280359115194977582517363610532464295210669530407870753439127455401384569705425621445943992963380983084917385428631223046908837804126399345875252917090184158440305503817193246288672986488987883177380307377025079266030262650932575205141853413302558460364242355531272967481409414783634558791175827816540767545944534238189079030192843288596934979693517964655661507346729751987928147021620165009965051933278913952899114253301044747587310830419190623282578931589587504555005361571572561916866063458812965314474160499067525067495140150092119620928363007467390920130717521169105167963364154636472055084012592138570354390246779276003156184676298710746583104700516466091034510765027167956117869051938116457370384737440965109619578227422049806566060571831017610877072484262724789571076529586427405780121096546942812322324807145137017942266863534989082115189065560011841150908380937354301243153206428896320576609904361937035263985348984794208198892615898907005955403529470847124269512316191753950203794578656029324506688293446571598506042198219080325747328636232040936761788558421528960279832802127562115852304946867628316502959562274485483867481731149338209009753229463924855930103271197831370982488703456463385914801246828662212622006947380115549529820197355738525329885232170215757585685484402344437894981555179129287164971002033759724456
p = 2**2203 - 1
q = 2**2281 - 1
phi = (p - 1)*(q - 1)
d = pow(e, -1, phi)
pt = pow(c, d, n)
print(long_to_bytes(pt))
```
##### c) Kết quả:
`crypto{Th3se_Pr1m3s_4r3_t00_r4r3}`
#### 3. Fast Primes:
##### a) Mô tả đề bài:
*"Tôi cần tạo ra hàng triệu khóa RSA một cách nhanh chóng và cách tiêu chuẩn không cắt được. Đây là một cách nhanh chóng khác để tạo ra số nguyên tố đã thực sự vượt qua nhiều năm xem xét."*
##### b) Phân tích cách làm:
- Cho file chứa ciphertext dạng hex và Public Key dạng PEM. Cần giải mã PEM để tìm ra $e$ và $n$.
- Dùng **factordb.com** $p$ và $q$ và tìm $d$.
- `key2 = RSA.construct((n, e, d))`: Tạo ra Private Key từ các thông số đã có.
- `cipher = PKCS1_OAEP.new(key2)`: Tạo ra đối tượng `cipher` sử dụng Private Key `key2` và phương thức padding OAEP để giải mã thông điệp.
- Source code:
```python
from Crypto.Util.number import long_to_bytes
from Crypto.PublicKey import RSA
from Crypto.Cipher import PKCS1_OAEP
from Crypto.Util import number
ct = 0x249d72cd1d287b1a15a3881f2bff5788bc4bf62c789f2df44d88aae805b54c9a94b8944c0ba798f70062b66160fee312b98879f1dd5d17b33095feb3c5830d28
pem_data = '''-----BEGIN PUBLIC KEY-----
    MFswDQYJKoZIhvcNAQEBBQADSgAwRwJATKIe3jfj1qY7zuX5Eg0JifAUOq6RUwLz
    Ruiru4QKcvtW0Uh1KMp1GVt4MmKDiQksTok/pKbJsBFCZugFsS3AjQIDAQAB
    -----END PUBLIC KEY-----'''
key1 = RSA.importKey(pem_data)
n = key1.n
e = key1.e
p = 51894141255108267693828471848483688186015845988173648228318286999011443419469
q = 77342270837753916396402614215980760127245056504361515489809293852222206596161
phi = (p - 1)*(q - 1)
d = pow(e, -1, phi)
key2 = RSA.construct((n, e, d))
cipher = PKCS1_OAEP.new(key2)
pt = cipher.decrypt(long_to_bytes(ct))
print(pt)
```
##### c) Kết quả: 
`crypto{p00R_3570n14}`
#### 4. Ron was Wrong, Whit is Right:
##### a) Mô tả đề bài:
*"Đây là loạt khóa công khai RSA mà tôi đã thu thập từ mọi người trên mạng cùng tin nhắn họ đã gửi.
Như **extract.py** cho thấy, mọi người đều sử dụng PKCS#1 OAEP để mã hóa tin nhắn của họ. Không thể giải mã chúng nhưng có lẽ có vấn đề với một số khóa?"*
##### b) Phân tích cách làm:
- Cho file source code và zip của, xác định được mã PEM và ciphertext số $21$.
- Tương tự như bài trên:
```python
from Crypto.Cipher import PKCS1_OAEP
from Crypto.PublicKey import RSA
from Crypto.Util.number import long_to_bytes
from Crypto.Util import number

'''msg = "???"

with open('21.pem') as f:
key = RSA.importKey(f.read())

cipher = PKCS1_OAEP.new(key)
ciphertext = cipher.encrypt(msg)

with open('21.ciphertext', 'w') as f:
f.write(ciphertext.hex())'''

ct = 0xc62d91677825632cb8ac9d2fbee7490fca70b3f067bd8d811fa446a21001de7943cacafc429b2513d3f20c3224d212ca2937a4a4ea10792a1c498b791e978e4b050b525576bc68421e40d9f420c0b8a07778daf69edf2095bf48222896bb2d6581288ce7a2e7aec15a88a440ff1a1e48beb56f68b4f860d1f64a6ec8cafed90846b7d893bc482df69c8478d5a0d6fc2d043cdd97178740a9eb59d2576b5136200c8ea77e648c88e6c5104ca5d0c6add2fc2c8569ce909f8461e7fa3d901fe67eaeff656399d4751fedba9973e246427e0c7a217f5bdc3edcb5033f17b5ef53419e340355a809eb46f48f538e880abd6f72212b02d3dbf2c4f633a503e648d1a835c4574b23e329e1c51078ea7cbb7533e771899498d4a5760bc0799b7e046f268f098fe0b57de47cd70ccf01ad3c9daec5027f306141bfe7a6c0bd29ee6caf94c7433c25e34ee974005e2360337cb6b3cec5eaf5d31d19f01435f4cdcaa455a18e78dee078395b8ad14b9c3a0d817dc1e3109c7b8af35ab3a5950bf47d5e621f9373ef421540052aac307ecea91f9c29c14bfd81b41d4c5a9b34a8ec2fa1ae06c3d881f39286c3d8dbb1849602fecc27bb135f7dd443e2598d247d1182d350b04be1ac0a734cb0e852a36902d88066ac375a35e279b126e413a97aaa35a0ba933f7b8d574c298332ce428c181464b240709a414af1b77103441b6ccfd0790eccea5926844054903c83f4cb415d600a6b7bc771c9e7a86394a2b427ebe8edec08b8095f561827716898e11caf6f0fe562af8a69f7b6469f0e86bdcc32f429f10821c763b34307efc5b2ae7fd524a07e5d0b762c096f025a3f240fb7bd3554582dcce32c175867d93970b0422e17870ec58f2a305545a3d284b3abb2d21a45ad8fd5faed0dc66312a5aa2f994606a51cd6682acd48ea3fb883f0611e1e5c2fb4047b5c80815ba5d3bcfefaf121bfde4d5c91ee27bb899ef0d29fa5c6dc4223ac2bfcff0217d08579a13e9b02dc97aa2622df62eeaaa38bb3bd087cdd209f03e8926a951e90eaa0f678a252a067ac66402a4c85865931689ed3b33f9f6de0c499f140ef508dfba6007a607a271dcbec18a61f7488bba34d143f93bc259310ffbf23f3391734d8d8811a4be8abf6382e55c2ccbfd80b1559d907fd8d46e0431cdbcd8fdb06d57973437f7b8ff5efc5a53c80d552e8fe622971f7376eeea35f4df9b32ada93e531a52b63ba13f6b7bf61ab337d6d93feb0e8c8a309dfa7e5f50e8cf9655b73ae64822b50db5312f35f4718b0668305065ea283ddf8f0a4e8f486ee9d119ebc584be1837b3d959a25ace208ffac2fb703390a72d3027b64fdd1955b513c0403f09232efa1794a277e0be3f4f9f3a6fd23c6e52101e723cef5db7a2a18a107cd522379adb40c5ed36b26cdf53a1000d7d576f1157b42aac3d3ee011275
pem_data = '''-----BEGIN PUBLIC KEY-----
    MIIEIjANBgkqhkiG9w0BAQEFAAOCBA8AMIIECgKCBAEA1dlvn9lQ5f+ZsWc1iPw6
    HVY487KX7ASSJhZ4VMUGGkD+YVQnhTXLS7NWyL6qHu9tbx5pzyyC4jT65CjEeRaV
    XTswGdH/kicZBLjBKUh0iayUfzASs4rYe3G62noWTDAtHs3+VBDMxGid+/TsgoxK
    Qo/eTG7Evci9MdDUAgHhXAqQfM4Ot/HWlxogwikAs7SDyaZLNkxZFEKcqrS81udT
    Nm0lsUceoNXBxb662iqFJN8Q7S4XYjYaDnScZdWc8HwhDnqStBJ1ATvVIXM9+AB3
    rNlJ+GVG3kE7Azh59+1kKqdVRf9Zl0Ch65JUMLEpTKRQuBJxLzY2MbmbcxIv5bbB
    EPz6a3iTQtquE49nqx07fEcxNoL1vCBa//MS4fBXYwTIT3W1irM8HQxB76MUlzp4
    mSZnxHNWbLuA4kP79qwIzcxh1aUDYRYMp3mGlnJzLlUqhQJenFr5piNq03l1lRix
    dCIjtso6eFgNv+MD1ndYsqL2ktFC0u6kvOVbyL4roW1m1STXcis5/BWTtnxe/o3m
    TFClvzfvi6BWdK5m7vJ7Pp6bE8FEei81SBTGNX0B+K6W3DiaDOzwTr9amTaRzbSA
    LtpXUBHbFEpKYlbBgCvX8uIB6L8IS5XQPtnPu+3dKXczLXu/hIRzJf6KQqwbL/xT
    d6sSeXV/4t96dvtGoXh/fMR2CpHfSH5j3Akij9uQapvHwNyiL4t7Bd2+J3tYd0aX
    94pg3wWtHhzXK5YEukLifyCh1Wf+T1EPD5d0sNKvCuFpzHHHPf6gGT2riWmgUv+Z
    /eBrUJOSjEp7SD36JXML22T+rUT3ZGh76fzgjMpB1TUeY39OsmTPpNVEaymefxR8
    8hxkpEed6PJTL58mj3ACFP+ZAX0DZMap6hReBqkZ+Y2KUbKmAeCDCMHwUGIekWZg
    lRAKj0oqCyFpIv0abBc2SrEK1J9v5J2q/X4nk+uffHA+YhIt3q4r9kRryvzXc6+t
    Qm1uggdgkrEM3zTtSPRhBsbqw2zjzTvy2naCUaFVKHoy/3clgR47zQUnYWp1epQg
    cpPwjgQIipyA4d9gQx4eJq4pv/bal0zoDLFVwOMZINVl8S37lnffqjSmsmLMv6fa
    pnPkcyXvxFWjtl8ltf7fzWPWGpJYdohtqxDr3Y1eXza53iSAnGUApQ/uwTPgTKhJ
    DlF8M5lSLrUC2faYP229ySm/mf+u9XPudAZ26qW93aAQ8Seg9WCHWuCYXQapBiV6
    wI1V6eU0TPXMKIElFe5qlBLrbuSm+i12qaMXuWC53yX4jLD/NILdrpvzELeM+426
    BMUhR4Dvy+U64DjH+f9DjG9eI52ldA5lGLHS169mbQx+Zc108dyEc5MjRinPkXJu
    jwIDAQAB
    -----END PUBLIC KEY-----'''
key1 = RSA.importKey(pem_data)
n = key1.n
e = key1.e
#print(n)
p = 919031168254299342928662994540730760042229248845820491699169870943314884504551963184014786520812939038906152950817942941469675496074887272906954399256046690838233813273902630076899906873722574023918253104149453601408405078374008695616160025877687382663027910687942091698042309812910101246025081363544171351624307177908410700904833438480012985928358897861427063761678614898919524867442676631453135379994570031284289815099294504127712924001149921480778993635917803466637717023744788311275545126346774536416864472035644211758788016642401235014385037912224180351022196262011724157012443048941426178651665266181311662824205620324073087330858064769424755443807165558567191049013947419763315902476674266627953223373671797370373786249718677582213173537848582863398367624397247597103174897140005790273296171101569756006898658668311846034013183862374297777882433967015111727139360441681664840944403450472574336901043555319067050153928231938431298082827397506406624964952344826628463723499263165279281720105570577138817805451223334196017505528543229067732013216932022575286870744622250293712218581458417969597311485156075637589299870500738770767213366940656708757081771498126771190548298648709527029056697749965377697006723247968508680596118923
q = 991430390905926023965735525726256769345153760248048478891327804533279477721590201738061124861790305326884541900044434890157058142414306020739922709698601329762087825767461256626800629782378634339618941488765491437487541851308806651586976069659042714378353883168031522106709494592827914376213512564492771821921367377484213072867988877925314809325159382342584541006645302760204539354879391605736604946702073863673524002591877977949645618863730441482821840664748508050205004505250025193611888170440612737112479006348533153568103452396596042639466753099280111709882461562564978070397786887446291916733276692400981917025361391646188802038772976331121474570242334921390569285834250256522656433623912544555266998750630136756355560927237594975904642791712318215315246754105993145827690531584325461597482035600919501967088106457091199733024323755210212616553447076697617349235377466327471959683763796707566328536834402308887105044128592177681553611608618850780128709949316259039664054913946726480968288231015999572777436469163437066403964134928735809253108394078092917006632332098357725950865697047565284013456253933234017983509582245874130968218422573483012858388392588302838940565560162598810462310034964473576147200222580784694005333482381
phi = (p - 1)*(q - 1)
d = pow(e, -1, phi)
key2 = RSA.construct((n, e, d))
cipher = PKCS1_OAEP.new(key2)
pt = cipher.decrypt(long_to_bytes(ct))
print(pt)
```
##### c) Kết quả:
`crypto{3ucl1d_w0uld_b3_pr0ud}`
**https://eprint.iacr.org/2012/064.pdf**
#### 5. RSA Backdoor Viability:
##### a) Mô tả đề bài:
*"Có vẻ phương pháp tạo số nguyên tố nhanh không hoàn toàn an toàn. Tôi nghĩ ra cách tiếp cận mới để cải thiện tính bảo mật, bao gồm cả cửa hậu nhân tố hóa trong trường hợp mất khóa riêng. Chắc chắn sẽ cần một số kỹ thuật phức tạp để phá vỡ điều này!
Có thể cần phải điều chỉnh giới hạn đệ quy (`sys.setrecursionlimit(n)` trong Python) bằng ngôn ngữ lập trình để giải pháp của hoạt động."*
- Cho:
```py
#!/usr/bin/env python3

import random
from Crypto.Util.number import bytes_to_long, getPrime, isPrime

FLAG = b"crypto{????????????????????????????????}"

def get_complex_prime():
    D = 427
    while True:
        s = random.randint(2 ** 1020, 2 ** 1021 - 1)
        tmp = D * s ** 2 + 1
        if tmp % 4 == 0 and isPrime((tmp // 4)):
            return tmp // 4

m = bytes_to_long(FLAG)
p = get_complex_prime()
q = getPrime(2048)
n = p * q
e = 0x10001
c = pow(m, e, n)
print(f"n = {n}")
print(f"e = {e}")
print(f"c = {c}")
```
và
```py
n = 709872443186761582125747585668724501268558458558798673014673483766300964836479167241315660053878650421761726639872089885502004902487471946410918420927682586362111137364814638033425428214041019139158018673749256694555341525164012369589067354955298579131735466795918522816127398340465761406719060284098094643289390016311668316687808837563589124091867773655044913003668590954899705366787080923717270827184222673706856184434629431186284270269532605221507485774898673802583974291853116198037970076073697225047098901414637433392658500670740996008799860530032515716031449787089371403485205810795880416920642186451022374989891611943906891139047764042051071647203057520104267427832746020858026150611650447823314079076243582616371718150121483335889885277291312834083234087660399534665835291621232056473843224515909023120834377664505788329527517932160909013410933312572810208043849529655209420055180680775718614088521014772491776654380478948591063486615023605584483338460667397264724871221133652955371027085804223956104532604113969119716485142424996255737376464834315527822566017923598626634438066724763559943441023574575168924010274261376863202598353430010875182947485101076308406061724505065886990350185188453776162319552566614214624361251463
e = 65537
c = 608484617316138126443275660524263025508135383745665175433229598517433030003704261658172582370543758277685547533834085899541036156595489206369279739210904154716464595657421948607569920498815631503197235702333017824993576326860166652845334617579798536442066184953550975487031721085105757667800838172225947001224495126390587950346822978519677673568121595427827980195332464747031577431925937314209391433407684845797171187006586455012364702160988147108989822392986966689057906884691499234298351003666019957528738094330389775054485731448274595330322976886875528525229337512909952391041280006426003300720547721072725168500104651961970292771382390647751450445892361311332074663895375544959193148114635476827855327421812307562742481487812965210406231507524830889375419045542057858679609265389869332331811218601440373121797461318931976890674336807528107115423915152709265237590358348348716543683900084640921475797266390455366908727400038393697480363793285799860812451995497444221674390372255599514578194487523882038234487872223540513004734039135243849551315065297737535112525440094171393039622992561519170849962891645196111307537341194621689797282496281302297026025131743423205544193536699103338587843100187637572006174858230467771942700918388
```
##### *b) Phân tích cách làm:*
- `sys.setrecursionlimit(n)`: Thiết lập giới hạn đệ quy trong Python, ngăn ngừa lặp vô hạn hoặc tiêu tốn nhiều tài nguyên. Chỉ nên thay đổi giới hạn đệ quy khi cần thiết.
- Dùng factordb.com tìm $p$ và $q$, tương tự bài trên:
```py
from Crypto.Util.number import long_to_bytes

n = 709872443186761582125747585668724501268558458558798673014673483766300964836479167241315660053878650421761726639872089885502004902487471946410918420927682586362111137364814638033425428214041019139158018673749256694555341525164012369589067354955298579131735466795918522816127398340465761406719060284098094643289390016311668316687808837563589124091867773655044913003668590954899705366787080923717270827184222673706856184434629431186284270269532605221507485774898673802583974291853116198037970076073697225047098901414637433392658500670740996008799860530032515716031449787089371403485205810795880416920642186451022374989891611943906891139047764042051071647203057520104267427832746020858026150611650447823314079076243582616371718150121483335889885277291312834083234087660399534665835291621232056473843224515909023120834377664505788329527517932160909013410933312572810208043849529655209420055180680775718614088521014772491776654380478948591063486615023605584483338460667397264724871221133652955371027085804223956104532604113969119716485142424996255737376464834315527822566017923598626634438066724763559943441023574575168924010274261376863202598353430010875182947485101076308406061724505065886990350185188453776162319552566614214624361251463
e = 65537
c = 608484617316138126443275660524263025508135383745665175433229598517433030003704261658172582370543758277685547533834085899541036156595489206369279739210904154716464595657421948607569920498815631503197235702333017824993576326860166652845334617579798536442066184953550975487031721085105757667800838172225947001224495126390587950346822978519677673568121595427827980195332464747031577431925937314209391433407684845797171187006586455012364702160988147108989822392986966689057906884691499234298351003666019957528738094330389775054485731448274595330322976886875528525229337512909952391041280006426003300720547721072725168500104651961970292771382390647751450445892361311332074663895375544959193148114635476827855327421812307562742481487812965210406231507524830889375419045542057858679609265389869332331811218601440373121797461318931976890674336807528107115423915152709265237590358348348716543683900084640921475797266390455366908727400038393697480363793285799860812451995497444221674390372255599514578194487523882038234487872223540513004734039135243849551315065297737535112525440094171393039622992561519170849962891645196111307537341194621689797282496281302297026025131743423205544193536699103338587843100187637572006174858230467771942700918388
p = 20365029276121374486239093637518056591173153560816088704974934225137631026021006278728172263067093375127799517021642683026453941892085549596415559632837140072587743305574479218628388191587060262263170430315761890303990233871576860551166162110565575088243122411840875491614571931769789173216896527668318434571140231043841883246745997474500176671926153616168779152400306313362477888262997093036136582318881633235376026276416829652885223234411339116362732590314731391770942433625992710475394021675572575027445852371400736509772725581130537614203735350104770971283827769016324589620678432160581245381480093375303381611323
q = 34857423162121791604235470898471761566115159084585269586007822559458774716277164882510358869476293939176287610274899509786736824461740603618598549945273029479825290459062370424657446151623905653632181678065975472968242822859926902463043730644958467921837687772906975274812905594211460094944271575698004920372905721798856429806040099698831471709774099003441111568843449452407542799327467944685630258748028875103444760152587493543799185646692684032460858150960790495575921455423185709811342689185127936111993248778962219413451258545863084403721135633428491046474540472029592613134125767864006495572504245538373207974181
phiN = (p - 1)*(q - 1)
d = pow(e, -1, phiN)
m = pow(c, d, n)
print(long_to_bytes(m))
```
##### c) Kết quả:
`crypto{I_want_to_Break_Square-free_4p-1}`
### V. PADDING:
#### 1. Bespoke Padding:
##### a) Mô tả đề bài:
- *"Tôi đang xây dựng padding của riêng mình, bây giờ flag của tôi mỗi lần đều khác nhau!"*
- Kết nối tại `socket.cryptohack.org 13386`
##### b) Phân tích cách làm:
- Source code đề cho:
```py
#!/usr/bin/env python3

from utils import listener
from Crypto.Util.number import bytes_to_long, getPrime
import random

FLAG = b'crypto{???????????????????????????}'

class Challenge():
    def __init__(self):
        self.before_input = "Come back as much as you want! You'll never get my flag.\n"
        self.p = getPrime(1024)
        self.q = getPrime(1024)
        self.N = self.p * self.q
        self.e = 11

    def pad(self, flag):
        m = bytes_to_long(flag)
        a = random.randint(2, self.N)
        b = random.randint(2, self.N)
        return (a, b), a*m+b

    def encrypt(self, flag):
        pad_var, pad_msg = self.pad(flag)
        encrypted = (pow(pad_msg, self.e, self.N), self.N)
        return pad_var, encrypted

    def challenge(self, your_input):
        if not 'option' in your_input:
            return {"error": "You must send an option to this server"}

        elif your_input['option'] == 'get_flag':
            pad_var, encrypted = self.encrypt(FLAG)
            return {"encrypted_flag": encrypted[0], "modulus": encrypted[1], "padding": pad_var}

        else:
            return {"error": "Invalid option"}

import builtins; builtins.Challenge = Challenge # hack to enable challenge to be run locally, see https://cryptohack.org/faq/#listener
"""
When you connect, the 'challenge' function will be called on your JSON
input.
"""
listener.start_server(port=13386)
```
- Kết nối trong Ubuntu được hai padding `"encrypted_flag": encrypted[0], "modulus": encrypted[1], "padding": pad_var` như sau: 
```ubuntu
kanrorikakemem@Asus:~$ nc socket.cryptohack.org 13386
Come back as much as you want! You'll never get my flag.
{"option" : "get_flag"}
{"encrypted_flag": 8331312789958717068708316566943084224749549855125271456237815008184807811390891558610155781733605653915356495336685330684514872238902880430192451979157911403444860906607979295272808881895943629716403483853457262726957156098741055683050350991510575828583211120550688311248646416142837093084183843937714367131432130125853391366526930373358746172781086650018939841312966108511891542703408772208765758560009665354850929749692687524501376556195128957568075475923050258130953496572831901694979309765178539377985919544515638775268151420115804571070424840071928548670905141561333201047875316079709360115117456833388992275461, "modulus": 26831060884401864388612627210667838430040966882393876126303526531649556205449444510667215498266757102003639201231060393044748279472268696044824184424539976127468019770982367784757100187131456495518607696529030201468190696022725221114622064340551223950645320931724761076528041885097440898794163202866442112803811242848956162993395988472959852341954119697457842740528363488953301102290791320733799847139023954300697257774910902247578435074203349350564054211438843416872274995938613283833495883663828519499881672426459332782515723795297827339949352626031909266237387126209787354697877792539362891060950062424198889261549, "padding": [25074240253281955039684509086837531845913290543888250621157403735571077789685004040486380445895655919487280669934549097170104354397180907872269283214477289930089960570264433187223860677447412918130580465957053150575722844402614854631531933517882641585356422246609222709918853684539938720416980258755907494212318219706946389647290465452412690180706422233307555732198104854408645940495188044762946475292436876643205613527577936004007854157086731680994348884191563842642039338589950365325224518380139683680619172636052272176863532752510915196601832397684904688207546647932896335961766595938411028519956434783585874483731, 24758474342609906038921157308826899411982930040686389771372698720942150533362948235586887194881471250683981932910547008584742682510034705452466181849149850836722682672325080770500032740120818644551551453974558540536214740265257171453578153993375294480451380454124946661183018456614324648849470145094830150303666305363950839213901145924968606787816251266969746519322852109654367582727524493079106810859366048126127246226795704679182158849577071912729479165019312318751436148817621446786894448396697461163773323621015808907933148998691276681683635251561241854410247835877977258053028826288388671013433084672212873140298]}
{"option" : "get_flag"}
{"encrypted_flag": 21331092897645509570561868277099161274502662966910425570439103605832066079346447842231239152033972940532814236510166252652577937264635717202041286895240927259178710483820547922193081075912675806647896445383734941086995514422703785403357919600080053769009475027241498198642582279909345399708536773007977508506597764792784613375223482010300568596287158334745809470403816948169662308408009491783509786253663790453481664672065784028332848765541971337809644307404749570357267614089759006920020528053070467804436137620862052743250545758479769094096649861928439765714774142324465489959922620262841391733013541500533523105027, "modulus": 26831060884401864388612627210667838430040966882393876126303526531649556205449444510667215498266757102003639201231060393044748279472268696044824184424539976127468019770982367784757100187131456495518607696529030201468190696022725221114622064340551223950645320931724761076528041885097440898794163202866442112803811242848956162993395988472959852341954119697457842740528363488953301102290791320733799847139023954300697257774910902247578435074203349350564054211438843416872274995938613283833495883663828519499881672426459332782515723795297827339949352626031909266237387126209787354697877792539362891060950062424198889261549, "padding": [24045594492625958943729104313935859250940996428884741923368854133678378933129781736773296786488824663546968107529323994460945389075957627340637590939240238775948258539542670614387602007034359612423895559085252652824375380792613207355145914670754869392440947689170769617054061085868000474710844332524214239113281747373724148112196715490575354965304685079815508763103461460039061051320429681827670571759316473133348808493817732226240762843080489903362920314701299895318172748664025436074389188137533119243657125259705048910283533560452818882773099230374831421485649253734625014713288494732197341590932459398779925515762, 16698415595102127218116498367279929224655269833492010830559104117818824096733214438402331673119624328065016175819504742451079430367841462045554018630550620607853600744157869599240644879866459419957665830140053159541380090765729226064550793969610797950364522971028546865367152135582094826787027853338837730448655097788467513095245522348208308147085187162893300689454186910290499515071800071484028663800542173761799976690321861114758976009915642492038797403788620833692023503064870787985295959621876324643278205226554653602312118507080903395353946286981126465754539593943703218714922239213544601434864703907128255241791]}
```
- Theo đề, $m$ được thêm padding với hai giá trị ngẫu nhiên $a$, $b$ sao cho $m' = a.m + b$. Đặt $x = m$ là nghiệm hệ phương trình $(1)$: 
    $$\begin{align}
      c_1 = (a_1.x + b_1)^e \mod N \\
      c_2 = (a_2.x + b_2)^e \mod N
    \end{align}$$ Suy ra $(2)$:
    $$\begin{align}
      f_1 = (a_1.x + b_1)^e - c_1 ≡ 0 \mod N \\
      f_2 = (a_2.x + b_2)^e - c_2 ≡ 0 \mod N
    \end{align}$$
- Giả sử $(1)$ có nghiệm chung $x = M$: 
    $$\begin{align}
      c_1 = (a_1.M + b_1)^e \mod N \\
      c_2 = (a_2.M + b_2)^e \mod N
      \end{align}$$ Có thể viết lại:
      $$\begin{align}
      f_1 = (a_1.x + b_1)^e - c_1 = (a_1.x + b_1)^e - (a_1.M + b_1)^e ≡ 0 \mod N \\
      f_2 = (a_2.x + b_2)^e - c_2 = (a_2.x + b_2)^e - (a_2.M + b_2)^e ≡ 0 \mod N
    \end{align}$$
- Do $M$ là nghiệm chung nên có thể phân tích thành nhân tử:
    $$\begin{align}
      f_1 = (x - M).h(x) ≡ 0 \mod N \\
      f_2 = (x - M).k(x) ≡ 0 \mod N
    \end{align}$$
- $GCD(f_1, f_2)$ có dạng $(x - M)$. Lấy hệ số tự do $-M$ của đa thức bằng `coefficients()[0]` và đổi dấu để ra $M$.
- Source code SageMath:
```py
from Crypto.Util.number import long_to_bytes

c1 = 5522804277757343476487250489886599578816171506300839083231889529167378081210615153774873562524907238985179431483538564951636675378306799205484928746480434503678409043481909642670228762322121051755357816744281159892556961645502988382274525454458137618044908616104624219582878266980746145373881819910644650741628595351445384882273662223654819318297389878688315533882878379152585392791061007333561248478410238994704154973329615766073628002169009248819948726084160705192296407227120707858244982277558978894152842875271135856075025461303914437595810882742375589364002399046273877281055240442485808306421492612988545231880 
N =  17938993248947302883061889394488876837305713226873079581947960844904293707581656881601164245820267703441792203276614339347691546273887020747571824615454794129857852976424624849935493835392302123327121977823138488076313171349920262099880407133450691543839661731628439840416393967531711937078136546295397481321116214783361667574545553575029346401444936698880864012783195044274353778352274828389671782600171979909625440608757388464355696882587030714294673213905147842423028762704599211596683091341709022289163078201295839382775254282252278668909369233488155531504163119180910341969341637734100203882661568774934217509667 
a1 = 9462099024816905309200789346510486230021167517930689244709368558916462753664576848171410864255440875578146858709589523768492058024002498211542805366434347149022861893124778271780930673055338400127763325901064868387640419860336855451673932087532051382010408825274593139077769893295579091618181754976202470942915439759334391537046902019909037829783892551562733147612559095524266563672024935168887511005295685459438901123116002527446741256903809940892109711117152423194062276130264715158145896782514449510244152147725168994649928653300616728055864896672842105153468831142569608232366614051083221423850095101998590328273
b1 = 9345246504641804463406272554677221161175638418185998189036101789678714434791884113529523851949958757381705230507027885941466256745581831081562491172147983145274981133789297071011222215722262147836498440692368973677772135942098086499111584397592685369697858701755110615693680501520406586992642347536693953107628373882347124009267672839735436306160310024835478874737092158518824350987961704833072491542157412552399750456571187539465397948369684106547628929158988327340782800896249328515005743963177040988164362925933762586622251969981529645172702445466190422280906119490231148372491005878534100779821976001855915816421
c2 = 17839744420635777801690706784213393982861327957886469869100709305432676459101107844086701574951891820869932250797418257131608737612511488881670296168373419628923827163197539859185969963993829737272509280316545600292117169945439027183166550272972918510999309276475375673543963272525125034299472340911511810970491282915195070335963818482902990635324338036436270482015076764344006935355664876672259529545567607587431815202991367019966703780010530121796107923974632900783089360467192337859545481115359786657611411471197954370500691539097249457583024244852483899739871454277215908074268728790002912743282624700106728356275 
a2 = 12152935411990204541313475519738112432836227996996529579002532043300797255367078874142550444249387637153236820873884697579093071834906632707221291470974829722538439635982694891919615340923463073175421998902166128898274605729244359103890757526377836201683999594404025397268177904480249247273269009052684766067095659002379607091530071957126319968632402376370120392651305895087072068351621491462645109874760138977120544095834436517926753004275023942936142154462618375734868229319741987983076311544391625737214908668857422247525023538648399210750550870093735897224687246545108392904535335581052829575733018049988735216701 
b2 = 3488609850758030034640910971976769935419710374486559279359083407561851069101156332281773706163222000430605474140746420673404575157747913363213608513629860982172046450255111727868337211042455193807321862779612544711778822499711263267482382216500819695974640605290878331315029903384652807120760774468675826101529429821532872085618210276004727481949579729139440131987819934102099435109900642500546068488221431258398955097431720537393565483551792066506748448157924223729858496373774572617432904254612957290936738469808326064330231771907219092488658369458147612555719388000970869238720434685373595057790089965203498813578
e = 11

P.<x> = PolynomialRing(Zmod(N)) #Chạy trong trường modulo N

f1 = (a1*x + b1)**e - c1
f2 = (a2*x + b2)**e - c2

def gcd(a,b):
    while b:
        a, b = b, a%b
    return a.monic() #monic() để chia toàn bộ đa thức cho hệ số của bậc cao nhất, sao cho hệ số mới bằng 1.

m = long_to_bytes(int(-gcd(f1, f2).coefficients()[0]))
#Lấy dấu âm vì ta cần đảm bảo rằng giá trị cuối cùng của thông điệp là hợp lý về mặt dấu.
#coefficients()[0] sẽ lấy hệ số của hằng số (bậc 0) trong GCD, vì đây là hệ số liên quan trực tiếp đến m.
print(m)
```
##### c) Kết quả:*
`crypto{linear_padding_isnt_padding}`
#### 2. Null or Never:
##### a) Mô tả đề bài:
- *"Có thể tùy chỉnh đệm một cái từ một số sai lầm mà chúng tôi đã đề cập?"* 
- Cho:
```python
#!/usr/bin/env python3

from Crypto.PublicKey import RSA
from Crypto.Util.number import bytes_to_long

FLAG = b"crypto{???????????????????????????????????}"


def pad100(msg):
    return msg + b'\x00' * (100 - len(msg))

key = RSA.generate(1024, e=3)
n, e = key.n, key.e

m = bytes_to_long(pad100(FLAG))
c = pow(m, e, n)

print(f"n = {n}")
print(f"e = {e}")
print(f"c = {c}")
```
và:
```python
n = 95341235345618011251857577682324351171197688101180707030749869409235726634345899397258784261937590128088284421816891826202978052640992678267974129629670862991769812330793126662251062120518795878693122854189330426777286315442926939843468730196970939951374889986320771714519309125434348512571864406646232154103
e = 3
c = 63476139027102349822147098087901756023488558030079225358836870725611623045683759473454129221778690683914555720975250395929721681009556415292257804239149809875424000027362678341633901036035522299395660255954384685936351041718040558055860508481512479599089561391846007771856837130233678763953257086620228436828
```
##### b) Phân tích cách làm:
- Có thể thấy FLAG đã được padding sao cho có thêm $57$ byte `\x00` ở sau (vì `len(FLAG) = 43`), hay $padding = 57$ x `\x00` $\rightarrow pad = m.(2^8)^{57} = 2^{8.57}m$
- Ta có: $$c = pad^e \mod n$$ Suy ra: $$c = (2^{8.57}m)^e \mod n$$ Tương đương: $$c.(2^{8.57.e})^{-1} = m^e \mod n$$
- Source code:
```py
from Crypto.Util.number import long_to_bytes
from gmpy2 import iroot, invert

n = 95341235345618011251857577682324351171197688101180707030749869409235726634345899397258784261937590128088284421816891826202978052640992678267974129629670862991769812330793126662251062120518795878693122854189330426777286315442926939843468730196970939951374889986320771714519309125434348512571864406646232154103
e = 3
c = 63476139027102349822147098087901756023488558030079225358836870725611623045683759473454129221778690683914555720975250395929721681009556415292257804239149809875424000027362678341633901036035522299395660255954384685936351041718040558055860508481512479599089561391846007771856837130233678763953257086620228436828
c1 = pow(2**(8*57), 3, n)
C = c*invert(c1, n)%n

for i in range(10000):
    x = C + i*n
    m = int(iroot(x, 3)[0])
    flag = long_to_bytes(m)

    if b'crypto' in flag:
        print(flag)
        break
```
##### c) Kết quả:
`crypto{n0n_574nd4rd_p4d_c0n51d3r3d_h4rmful}`
### VI. SIGNATURES PART 1:
#### 1. Signing Server:
##### a) Mô tả đề bài:
- *Sếp của tôi có nhiều email, anh ấy đã thiết lập máy chủ để tự động ký vào mọi thứ. Ông cũng lưu trữ các tin nhắn được mã hóa cho chính mình để dễ dàng truy cập. Tôi tự hỏi anh ấy đang nói gì.*
- Kết nối tại `socket.cryptohack.org 13374`
- Cho source code:
```py
#!/usr/bin/env python3

from Crypto.Util.number import bytes_to_long, long_to_bytes
from utils import listener

class Challenge():
    def __init__(self):
        self.before_input = "Welcome to my signing server. You can get_pubkey, get_secret, or sign.\n"

    def challenge(self, your_input):
        if not 'option' in your_input:
            return {"error": "You must send an option to this server"}

        elif your_input['option'] == 'get_pubkey':
            return {"N": hex(N), "e": hex(E) }

        elif your_input['option'] == 'get_secret':
            secret = bytes_to_long(SECRET_MESSAGE)
            return {"secret": hex(pow(secret, E, N)) }

        elif your_input['option'] == 'sign':
            msg = int(your_input['msg'], 16)
            return {"signature": hex(pow(msg, D, N)) }

        else:
            return {"error": "Invalid option"}

import builtins; builtins.Challenge = Challenge # hack to enable challenge to be run locally, see https://cryptohack.org/faq/#listener
listener.start_server(port=13374)
```
##### b) Phân tích cách làm:
- Đây là source code giải RSA của server.
- Kết nối bằng Ubuntu để lấy ciphertext.
- Nếu nhập `{"option": "sign", "msg": "ciphertext"}` với ciphertext vừa lấy được thì sẽ có signature.
- Source code:
```py
from Crypto.Util.number import long_to_bytes

ct = "0x36616f25259cd2f073ce920144b1054d891fcd20cf243c4fc0bac556b5d7240fe92d8a19db7cfcee183c64f29585226521189b3d1c8be02d79ee754856cf1efae8a136cb02e045edd3f44b704a759f756574db89571b4b2fc3e52258ff15224e93072360afd7cea95d81029bc59f400dc1492597b958b8183c87a07a909b7ab407d44e5f65875e8b94585bbc60662a022e0c5edb18a28746ead4b8f8247cb80012d53a04ffa720cb10de0927f21a1334a49f5dae246d659672f8ff27703a52412dc9291f4ea50edd0d53a61cd8032336b3e416496bf2c424154018d2793c2d778c83fc245d8fabad2053d3e77767ba0feb3c094887e5424efbf5c5f02f618ec5"
N = "0xac75f79fce92e1da50ca29668757467e2af8809f2474477e6635367bef04ea476e303bbfffc98b190d47fa17e5588925121f5a973f1078ce20741c13859af0f7542ebf8fcd5c1bad29b08eeada9aba6a7e40bffe61bc9f8f3e2e3b9fba18ea5ffe31c8316567aa989f763726b05e2533eb8750fb17af065040bf3662a700bdc54b75dbfce7624dded6b3ffe3a710ddb2183b45cba06f4858389e147ac907b26bfa752190bcfdc3eed9b1589bd034d4dbf8d53a5a83d74032ee2349b779c5ea9b98f0791c875bdeff5022254ddfe5d4b0e1f9bb606fd725e5b77484964c00a10dea4ab4dac4c1afe79777ed8ff9cdc635daced77b94713cc5d2e99f25e8fa3187"
e = "0x10001"
signature = "0x544f444f3a206175646974207369676e696e672073657276657220746f206d616b6520737572652074686174206d6564646c696e67206861636b657220646f65736e27742067657420686f6c64206f66206d792073656372657420666c61673a2063727970746f7b64306e375f3531366e5f6a7535375f346e793768316e367d"

res = int(signature, 16)
print(long_to_bytes(res))

# {"option": "sign", "msg": "0x36616f25259cd2f073ce920144b1054d891fcd20cf243c4fc0bac556b5d7240fe92d8a19db7cfcee183c64f29585226521189b3d1c8be02d79ee754856cf1efae8a136cb02e045edd3f44b704a759f756574db89571b4b2fc3e52258ff15224e93072360afd7cea95d81029bc59f400dc1492597b958b8183c87a07a909b7ab407d44e5f65875e8b94585bbc60662a022e0c5edb18a28746ead4b8f8247cb80012d53a04ffa720cb10de0927f21a1334a49f5dae246d659672f8ff27703a52412dc9291f4ea50edd0d53a61cd8032336b3e416496bf2c424154018d2793c2d778c83fc245d8fabad2053d3e77767ba0feb3c094887e5424efbf5c5f02f618ec5"}
```
- Kết quả: 
```
b"TODO: audit signing server to make sure that meddling hacker doesn't get hold of my secret flag: crypto{d0n7_516n_ju57_4ny7h1n6}"
```
##### c) Kết quả:
`crypto{d0n7_516n_ju57_4ny7h1n6}`
#### 2. Let's Decrypt:
##### a) Mô tả đề bài:
- *"Nếu có thể chứng minh bạn sở hữu Cryptohack.org, bạn có quyền truy cập vào một trong những bí mật của chúng tôi"*.
- Kết nối tại `socket.cryptohack.org 13391`
- Cho source code:
```py
#!/usr/bin/env python3

import re
from Crypto.Hash import SHA256
from Crypto.Util.number import bytes_to_long, long_to_bytes
from utils import listener
from pkcs1 import emsa_pkcs1_v15
# from params import N, E, D

FLAG = "crypto{?????????????????????????????????}"

MSG = 'We are hyperreality and Jack and we own CryptoHack.org'
DIGEST = emsa_pkcs1_v15.encode(MSG.encode(), 256)
SIGNATURE = pow(bytes_to_long(DIGEST), D, N)


class Challenge():
    def __init__(self):
        self.before_input = "This server validates domain ownership with RSA signatures. Present your message and public key, and if the signature matches ours, you must own the domain.\n"

    def challenge(self, your_input):
        if not 'option' in your_input:
            return {"error": "You must send an option to this server"}

        elif your_input['option'] == 'get_signature':
            return {
                "N": hex(N),
                "e": hex(E),
                "signature": hex(SIGNATURE)
            }

        elif your_input['option'] == 'verify':
            msg = your_input['msg']
            n = int(your_input['N'], 16)
            e = int(your_input['e'], 16)

            digest = emsa_pkcs1_v15.encode(msg.encode(), 256)
            calculated_digest = pow(SIGNATURE, e, n)

            if bytes_to_long(digest) == calculated_digest:
                r = re.match(r'^I am Mallory.*own CryptoHack.org$', msg)
                if r:
                    return {"msg": f"Congratulations, here's a secret: {FLAG}"}
                else:
                    return {"msg": f"Ownership verified."}
            else:
                return {"error": "Invalid signature"}

        else:
            return {"error": "Invalid option"}


import builtins; builtins.Challenge = Challenge # hack to enable challenge to be run locally, see https://cryptohack.org/faq/#listener
listener.start_server(port=13391)
```
##### b) Phân tích cách làm:
- Đây là server kiểm tra chữ kí số.
- Kết nối server trên Ubuntu để lấy `SIGNATURE`.
- Cần chú ý đoạn:
![image](https://hackmd.io/_uploads/Skmo1PIh1e.png)
- Từ source code trên: $$digest = calculated_-digest = SIGNATURE^e \mod N$$ Vì có thể nhập $N$ và $e$ tuỳ ý nên để đơn giản, chọn $e = 1$. Khi đó: $$digest = SIGNATURE \mod N$$ Tương đương: $$(SIGNATURE - digest \mod N) = 0$$ Suy ra: $$kN = SIGNATTURE - digest$$ Chọn $k = 1$, khi đó: $$N = SIGNATTURE - digest$$
- Tiếp tục kết nối server: 
```ubuntu
{"option": "verify", "msg": "I am Mallory.own CryptoHack.org", "N": "0x55c031eebc642cd1e44199e10937ee8b9e93c0c2d10a18b7b53a207fb1ddd4e6c2e08368a1943187bb1efe0378567340a0851710c426f609aa79d3b5bb3f8efe7f531cfdb54a9fba9e77e3ca2adcecdc299ebf601bd8926dd6ed4e7e71f96ef61cc041159eb0584ff4ce9f0d9e5cb49a91ba15226740f378340e40805aff2e20e275b783aa43a0ac670ec1af2d4e834acceda189add6ed7daf64ed8f9f9718f030c8a7d64afee7cf33beef5f790611eaef40e7c978e2355f3039a6df4f38113ce83ed669a733ce6a93e1fb04fdd6c28815beb6b62f886a47150fbdd44638894fec51825c3c78656da09429904aa934eb696aed4b12d7b0f1a9f3cca37ee2beb5", "e": "0x1"}
```
- Kết quả:
```ubuntu
{"msg": "Congratulations, here's a secret: crypto{dupl1c4t3_s1gn4tur3_k3y_s3l3ct10n}"}
```
- Source code:
```py
from Crypto.Util.number import bytes_to_long
from pkcs1 import emsa_pkcs1_v15

N = "0x80a5b8245992f64d2d11f1279a88d23dd76594fa0a37427e55482c819fe6eb727f7cde0a715c018f8e3c98cc721ff1f779e8c704f3ad2ce877eaecf680c7105685581ac1dc8d5040d602a47d8dba333e787599a7528154f8f72581f1119c1c1267078e8bfb4e2a67b00ad13827660381b8105590a72b7d1fa45bdd2c07cc12ab2d8f7c6578178e93aac1a29ccdd1ecbeeafa25fa425988376384f745a7613af437ad235826d7d1499a0b2e83401ce0781fb85aa801ae9c43a9f79b2bd4bc8817a2a0725272e847e3b397e1d27b86fa0ba038b2704534a98a12e5e133f2358521ee0ee59a892928543c4a71460cadc2c89e011b019c2094ca6d17a0c143dc9297"
e = "0x10001" 
signature = "0x55c231eebc642cd1e44199e10937ee8b9e93c0c2d10a18b7b53a207fb1ddd4e6c2e08368a1943187bb1efe0378567340a0851710c426f609aa79d3b5bb3f8efe7f531cfdb54a9fba9e77e3ca2adcecdc299ebf601bd8926dd6ed4e7e71f96ef61cc041159eb0584ff4ce9f0d9e5cb49a91ba15226740f378340e40805aff2e20e275b783aa43a0ac670ec1af2d4e834acceda189add6ed7daf64ed8f9f9718f030c8a7d64afee7cf33beef5f790611eaef40e7c978e2355f3039a6df4f38113ce83ed669a733ce6a93e1fb04fdd6c28815beb6b62f886a47150fbdd34668aa7ff55787874a7b6787a5942da4d73b3197eb792b39d0e338f48fc5f4c01a16a178"
msg = "I am Mallory.own CryptoHack.org"

N = int(N, 16)
e = int(e, 16)
signature = int(signature, 16)
# calculated_digest = pow(signature, e, N)
digest = emsa_pkcs1_v15.encode(msg.encode(), 256)
print(hex(1))
print(hex(signature - bytes_to_long(digest)))
```
##### c) Kết quả:
`crypto{dupl1c4t3_s1gn4tur3_k3y_s3l3ct10n}`
#### 3. Blinding Light:
##### a) Mô tả đề bài:
- *Đây là máy chủ ký và xác minh mã thông báo của tôi. Tôi không chắc nó đang ký đúng cách nhưng tôi thực hiện một số biện pháp bảo vệ để đảm bảo họ không trao mã thông báo quản trị cho bất kỳ ai.*
- Kết nối tại `socket.cryptohack.org 13376`
- Cho source code:
```py
#!/usr/bin/env python3

from Crypto.Util.number import bytes_to_long, long_to_bytes
from utils import listener

FLAG = "crypto{?????????????????????????????}"
ADMIN_TOKEN = b"admin=True"

class Challenge():
    def __init__(self):
        self.before_input = "Watch out for the Blinding Light\n"

    def challenge(self, your_input):
        if 'option' not in your_input:
            return {"error": "You must send an option to this server"}

        elif your_input['option'] == 'get_pubkey':
            return {"N": hex(N), "e": hex(E) }

        elif your_input['option'] == 'sign':
            msg_b = bytes.fromhex(your_input['msg'])
            if ADMIN_TOKEN in msg_b:
                return {"error": "You cannot sign an admin token"}

            msg_i = bytes_to_long(msg_b)
            return {"msg": your_input['msg'], "signature": hex(pow(msg_i, D, N)) }

        elif your_input['option'] == 'verify':
            msg_b = bytes.fromhex(your_input['msg'])
            msg_i = bytes_to_long(msg_b)
            signature = int(your_input['signature'], 16)

            if msg_i < 0 or msg_i > N:
                # prevent attack where user submits admin token plus or minus N
                return {"error": "Invalid msg"}

            verified = pow(signature, E, N)
            if msg_i == verified:
                if long_to_bytes(msg_i) == ADMIN_TOKEN:
                    return {"response": FLAG}
                else:
                    return {"response": "Valid signature"}
            else:
                return {"response": "Invalid signature"}

        else:
            return {"error": "Invalid option"}

import builtins; builtins.Challenge = Challenge # hack to enable challenge to be run locally, see https://cryptohack.org/faq/#listener
listener.start_server(port=13376)
```
##### b) Phân tích cách làm:
- Từ tên đề bài, dùng Blinding Attack.
- Kết nối server trên Ubuntu, lấy được $N$ và $e$.
- Server từ chối chữ ký `ADMIN_TOKEN = b"admin=True` nên cần biến đổi khác đi để lừa server:
    - Đặt $m$ $=$ `ADMIN_TOKEN = b"admin=True`, khi đó: $$M = m.r^e \mod N$$ Với $gcd(r, N) = 1$. Ở đây chọn $r = 2$.
    - Gửi $M$ để server ký và trả về $S$ $=$ $Blinding_-Signature$: 
    ```ubuntu
    {"option": "sign", "msg": "48322bafd8204fbfe36bd1553187d93379f85d562ea0222a1da0a5956b9e4bd48c5d7d56c433b16b5d9c33ee6e5d308254c275745b1c45c5d1b2be359e578352e04945d5d678dfa51af6ba7e4b5002400c999347413186b2bc4b70007a5a0a1750d4ed5a6bf0ba5bb8b4c9a0026aa12feddc95a9930b9259cccc12717ddef6b5d8dad08ea5f7145f646449848cc63c6383bdeb2f45bd7d7d20fc1af4dac53d7e17a45c130b0a8ec1220b708c8dd453a1e5e6bbf23fffcadc2edc801b5bbce481350ec8bac14dfcf6236d2f0ee855c7e79d9411c57680e75c6996f205ea9a99e2e6d132b01d620e83363a1741a5b65853df03e2b106dbc1d6e7ad4809ca717ffd"}
    ```
    Hệ thống trả về $S$ $=$ $Blinding_-Signature$: 
    ```ubuntu
    {"msg": "48322bafd8204fbfe36bd1553187d93379f85d562ea0222a1da0a5956b9e4bd48c5d7d56c433b16b5d9c33ee6e5d308254c275745b1c45c5d1b2be359e578352e04945d5d678dfa51af6ba7e4b5002400c999347413186b2bc4b70007a5a0a1750d4ed5a6bf0ba5bb8b4c9a0026aa12feddc95a9930b9259cccc12717ddef6b5d8dad08ea5f7145f646449848cc63c6383bdeb2f45bd7d7d20fc1af4dac53d7e17a45c130b0a8ec1220b708c8dd453a1e5e6bbf23fffcadc2edc801b5bbce481350ec8bac14dfcf6236d2f0ee855c7e79d9411c57680e75c6996f205ea9a99e2e6d132b01d620e83363a1741a5b65853df03e2b106dbc1d6e7ad4809ca717ffd", "signature": "0x6d65dcfe8f09ae022186b63b2665f4457d710a80dd1b01fe52d064af2461f8f848d81a59c48905b156a7ffc6a92ec43a94c3f18ef3e28b34fea35b1ab3454d20927731c238505529f5f00a345c02215f144f8c47467e9053255edf8a995264817f37a8cd1a6e48d94587a53c72028ce0fe025bc720b8a64ab0dc818f7dbe2bbc12b6e22cc150539f2496ab6b9de2f4cf41db2f6db4f5f3a031954fa7d83a8cffbcf2866f8cd85736f8a2c60c8778cd260beb597235d1c20094fbf321c23de11e7963fbaf5265c35d6247811f9826733ced0f7406dafea90300a1e37c188188d40b6c6b25e33e41d34b2cfc013b28ea5213db4f20bbb0cbb113d4eb054e8e630e"}
    ```
    - Với $S$ vừa có: $$S = M^d \mod N = (m.r^e)^d \mod N$$ Tương đương: $$S = m^d.r^{ed} \mod N$$ Vì trong RSA, $e.d ≡ 1 \mod \varphi(N)$ nên: $$S = m^d.r \mod N$$ 
    - Lấy được chữ ký $s$ thật: $$s = S.r^{-1} \mod N$$
- Với $m$ $=$ `ADMIN_TOKEN = b"admin=True` và $s$ có được:
```ubuntu
{"option": "verify", "msg": "61646d696e3d54727565", "signature": "36b2ee7f4784d70110c35b1d9332fa22beb885406e8d80ff296832579230fc7c246c0d2ce24482d8ab53ffe35497621d4a61f8c779f1459a7f51ad8d59a2a690493b98e11c282a94faf8051a2e0110af8a27c623a33f482992af6fc54ca93240bf9bd4668d37246ca2c3d29e390146707f012de3905c5325586e40c7bedf15de095b711660a829cf924b55b5cef17a67a0ed97b6da7af9d018caa7d3ec1d467fde794337c66c2b9b7c51630643bc669305f5acb91ae8e1004a7df990e11ef08f3cb1fdd7a932e1aeb123c08fcc13399e7687ba036d7f54818050f1be0c40c46a05b63592f19f20e9a5967e009d94752909eda7905dd865d889ea7582a7473187"}
```
Server trả về:
```ubuntu
{"response": "crypto{m4ll34b1l17y_c4n_b3_d4n63r0u5}"}
```
- Source code: 
```py
from Crypto.Util.number import bytes_to_long, inverse

N = "0x954e1412ba207b8a246ea515e81425aeb5471cf5062b6497b2c76312ccf150498779ca540464b09fe573df68b0cfdcac124ba799b8546b45b49eaae9fadd630d1b5562a9993c6a3da72d5222e24aa6e1f9c663bfd07f31f0cdef87a54f2fbf7151afc3fd329bd16692dcfa6794c3d94d00fb2e11b49557a491be3e510f0c3e22163487df65e54d68f43a3ecea44e48dc929f2d321c6bfdb2c6c233c704e0618041ace0be91f637f423e6161b36a1fe0f04445ee1f48dc5960659706bbcb97c1667c5f17d0f2395dad348a88f3efb7fa06f99f7963749679eb697cd178fce6f65cfee5b6c9c36096c96f5b5532a6a3b44127afe27f10015dd71a644d455f800d5"
e = "0x10001"
N = int(N, 16)
e = int(e, 16)
r = 2
ADMIN_TOKEN = b"admin=True"
m = bytes_to_long(ADMIN_TOKEN)
# print(hex(m)[2:])
M = pow(m*(r**e), 1, N)
# print(hex(M)[2:])
S = "0x6d65dcfe8f09ae022186b63b2665f4457d710a80dd1b01fe52d064af2461f8f848d81a59c48905b156a7ffc6a92ec43a94c3f18ef3e28b34fea35b1ab3454d20927731c238505529f5f00a345c02215f144f8c47467e9053255edf8a995264817f37a8cd1a6e48d94587a53c72028ce0fe025bc720b8a64ab0dc818f7dbe2bbc12b6e22cc150539f2496ab6b9de2f4cf41db2f6db4f5f3a031954fa7d83a8cffbcf2866f8cd85736f8a2c60c8778cd260beb597235d1c20094fbf321c23de11e7963fbaf5265c35d6247811f9826733ced0f7406dafea90300a1e37c188188d40b6c6b25e33e41d34b2cfc013b28ea5213db4f20bbb0cbb113d4eb054e8e630e"
S = int(S, 16)
r_inv = inverse(r, N)
s = (S*r_inv)%N
# print(hex(s))
```
##### c) Kết quả:
`crypto{m4ll34b1l17y_c4n_b3_d4n63r0u5}`

### SIGNATURES PART 2:
#### 1. Vote for Pedro:
##### a) Mô tả đề bài:
- *"Nếu muốn flag của tôi thì nên bỏ phiếu tốt hơn cho Pedro! Bạn có thể ký phiếu bầu của mình cho máy chủ là Alice không?""*
- Kết nối tại `socket.cryptohack.org 13375`
- Source code đề cho:
```py
#!/usr/bin/env python3

from Crypto.Util.number import bytes_to_long, long_to_bytes
from utils import listener

FLAG = "crypto{????????????????????}"


class Challenge():
    def __init__(self):
        self.before_input = "Place your vote. Pedro offers a reward to anyone who votes for him!\n"

    def challenge(self, your_input):
        if 'option' not in your_input:
            return {"error": "You must send an option to this server"}

        elif your_input['option'] == 'vote':
            vote = int(your_input['vote'], 16)
            verified_vote = long_to_bytes(pow(vote, ALICE_E, ALICE_N))

            # remove padding
            vote = verified_vote.split(b'\00')[-1]

            if vote == b'VOTE FOR PEDRO':
                return {"flag": FLAG}
            else:
                return {"error": "You should have voted for Pedro"}

        else:
            return {"error": "Invalid option"}


import builtins; builtins.Challenge = Challenge # hack to enable challenge to be run locally, see https://cryptohack.org/faq/#listener
listener.start_server(port=13375)
```
- File `alice.key`:
```py
N = 22266616657574989868109324252160663470925207690694094953312891282341426880506924648525181014287214350136557941201445475540830225059514652125310445352175047408966028497316806142156338927162621004774769949534239479839334209147097793526879762417526445739552772039876568156469224491682030314994880247983332964121759307658270083947005466578077153185206199759569902810832114058818478518470715726064960617482910172035743003538122402440142861494899725720505181663738931151677884218457824676140190841393217857683627886497104915390385283364971133316672332846071665082777884028170668140862010444247560019193505999704028222347577
e = 3
```
##### b) Phân tích cách làm:
- Với 
```py
m = b'VOTE FOR PEDRO' = long_to_bytes(pow(vote, ALICE_E, ALICE_N)).split(b'\00')[-1]
```
Suy ra: $$M = vote^e \mod N$$ với $M =$ `bytes_to_long(prefix + m)` và `prefix` là phần byte rác `b'\x00'` bị bỏ đi.
- Cần thay đổi giá trị của `prefix` để tìm $M$: $$M ≡ msg \mod (2^8)^{15}$$ Với $msg =$ `bytes_to_long(m)`. Vì `prefix` bị loại bỏ nên `prefix` $= k.(2^8)^{15}$ (do `len(m) = 14` nên cần ít nhất $15$ byte rác để giữ được $m$ nguyên vẹn), thực tế $n >> (2^8)^{15}$ nên chỉ cần xét $\mod (2^8)^{15}$.
- Suy ra $$vote^e ≡ msg \mod (2^8)^{15}$$
- Chạy source code sau trong SageMath:
```py
from Crypto.Util.number import bytes_to_long, long_to_bytes

N = 22266616657574989868109324252160663470925207690694094953312891282341426880506924648525181014287214350136557941201445475540830225059514652125310445352175047408966028497316806142156338927162621004774769949534239479839334209147097793526879762417526445739552772039876568156469224491682030314994880247983332964121759307658270083947005466578077153185206199759569902810832114058818478518470715726064960617482910172035743003538122402440142861494899725720505181663738931151677884218457824676140190841393217857683627886497104915390385283364971133316672332846071665082777884028170668140862010444247560019193505999704028222347577
e = 3
m = b'VOTE FOR PEDRO'
msg = bytes_to_long(m)
vote = int(mod(msg, 256**15).nth_root(3))
assert (vote**3) % (256**15) == msg
print(hex(vote))
```
- Kết nối server:
```ubuntu
{"option": "vote", "vote": "0xa4c46bfb65e7eccc4e76a1ce2afc6f"}
```
- Server trả về:
```ubuntu
{"flag": "crypto{y0ur_v0t3_i5_my_v0t3}"}
```
##### c) Kết quả:
`crypto{y0ur_v0t3_i5_my_v0t3}`
#### 2. Let's Decrypt Again:
##### a) Mô tả đề bài:
- *"Let's Decrypt quá dễ dàng, hãy làm lại!"*
- Kết nối tại `socket.cryptohack.org 13394`
- Cho source code:
```py
#!/usr/bin/env python3

import hashlib
import re
import secrets
from Crypto.Util.number import bytes_to_long, long_to_bytes, getPrime, inverse, isPrime
from pkcs1 import emsa_pkcs1_v15
from utils import listener
# from params import N, E, D

FLAG = b"crypto{????????????????????????????????????}"

BIT_LENGTH = 768

MSG = b'We are hyperreality and Jack and we own CryptoHack.org'
DIGEST = emsa_pkcs1_v15.encode(MSG, BIT_LENGTH // 8)
SIGNATURE = pow(bytes_to_long(DIGEST), D, N)
BTC_PAT = re.compile("^Please send all my money to ([1-9A-HJ-NP-Za-km-z]+)$")


def xor(a, b):
    assert len(a) == len(b)
    return bytes(x ^ y for x, y in zip(a, b))


def btc_check(msg):
    alpha = "123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"
    addr = BTC_PAT.match(msg)
    if not addr:
        return False
    addr = addr.group(1)
    raw = b"\0" * (len(addr) - len(addr.lstrip(alpha[0])))
    res = 0
    for c in addr:
        res *= 58
        res += alpha.index(c)
    raw += long_to_bytes(res)

    if len(raw) != 25:
        return False
    if raw[0] not in [0, 5]:
        return False
    return raw[-4:] == hashlib.sha256(hashlib.sha256(raw[:-4]).digest()).digest()[:4]


PATTERNS = [
    re.compile(r"^This is a test(.*)for a fake signature.$").match,
    re.compile(r"^My name is ([a-zA-Z\s]+) and I own CryptoHack.org$").match,
    btc_check
]


class Challenge():
    def __init__(self):
        self.shares = [secrets.token_bytes(len(FLAG))
                       for _ in range(len(PATTERNS) - 1)]
        last_share = FLAG
        for s in self.shares:
            last_share = xor(last_share, s)
        self.shares.append(last_share)

        self.pubkey = None
        self.suffix = None

        self.before_input = "This server validates statements we make for you. Present your messages and public key, and if the signature matches ours, you must undoubtably be us. Just do it multiple times to make sure...\n"

    def challenge(self, your_input):
        if not 'option' in your_input:
            return {"error": "You must send an option to this server"}

        elif your_input['option'] == 'get_signature':
            return {
                "N": hex(N),
                "E": hex(E),
                "signature": hex(SIGNATURE)
            }

        elif your_input['option'] == 'set_pubkey':
            if self.pubkey is None:
                pubkey = int(your_input['pubkey'], 16)
                if isPrime(pubkey):
                    return {"error": "Everyone knows RSA keys are not primes..."}
                self.pubkey = pubkey
                self.suffix = secrets.token_hex(32)

                return {"status": "ok", "suffix": self.suffix}
            return {"error": "I already had one"}

        elif your_input['option'] == 'claim':
            if self.pubkey is None:
                return {"error": "I need your modulus first, please"}

            msg = your_input['msg']
            n = self.pubkey
            e = int(your_input['e'], 16)
            index = your_input['index']
            if not (0 <= index < len(PATTERNS)):
                return {"error": "invalid index"}

            if not msg.endswith(self.suffix):
                return {"error": "Invalid message"}

            digest = emsa_pkcs1_v15.encode(msg.encode(), BIT_LENGTH // 8)
            calculated_digest = pow(SIGNATURE, e, n)

            if bytes_to_long(digest) == calculated_digest:
                r = PATTERNS[index](msg[:-len(self.suffix)])
                if r:
                    return {"msg": "Congratulations, here's a secret", "secret": self.shares[index].hex()}
                else:
                    return {"msg": "Ownership verified."}
            else:
                return {"error": "Invalid signature"}

        else:
            return {"error": "Invalid option"}


import builtins; builtins.Challenge = Challenge # hack to enable challenge to be run locally, see https://cryptohack.org/faq/#listener
listener.start_server(port=13394)
```

##### b) Phân tích cách làm:
##### c) Kết quả:
